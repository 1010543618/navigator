if(!jQuery)throw new Error("Bootstrap requires jQuery");+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]}}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one(a.support.transition.end,function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b()})}(window.jQuery),+function(a){"use strict";var b='[data-dismiss="alert"]',c=function(c){a(c).on("click",b,this.close)};c.prototype.close=function(b){function c(){f.trigger("closed.bs.alert").remove()}var d=a(this),e=d.attr("data-target");e||(e=d.attr("href"),e=e&&e.replace(/.*(?=#[^\s]*$)/,""));var f=a(e);b&&b.preventDefault(),f.length||(f=d.hasClass("alert")?d:d.parent()),f.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one(a.support.transition.end,c).emulateTransitionEnd(150):c())};var d=a.fn.alert;a.fn.alert=function(b){return this.each(function(){var d=a(this),e=d.data("bs.alert");e||d.data("bs.alert",e=new c(this)),"string"==typeof b&&e[b].call(d)})},a.fn.alert.Constructor=c,a.fn.alert.noConflict=function(){return a.fn.alert=d,this},a(document).on("click.bs.alert.data-api",b,c.prototype.close)}(window.jQuery),+function(a){"use strict";var b=function(c,d){this.$element=a(c),this.options=a.extend({},b.DEFAULTS,d)};b.DEFAULTS={loadingText:"loading..."},b.prototype.setState=function(a){var b="disabled",c=this.$element,d=c.is("input")?"val":"html",e=c.data();a+="Text",e.resetText||c.data("resetText",c[d]()),c[d](e[a]||this.options[a]),setTimeout(function(){"loadingText"==a?c.addClass(b).attr(b,b):c.removeClass(b).removeAttr(b)},0)},b.prototype.toggle=function(){var a=this.$element.closest('[data-toggle="buttons"]');if(a.length){var b=this.$element.find("input").prop("checked",!this.$element.hasClass("active")).trigger("change");"radio"===b.prop("type")&&a.find(".active").removeClass("active")}this.$element.toggleClass("active")};var c=a.fn.button;a.fn.button=function(c){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof c&&c;e||d.data("bs.button",e=new b(this,f)),"toggle"==c?e.toggle():c&&e.setState(c)})},a.fn.button.Constructor=b,a.fn.button.noConflict=function(){return a.fn.button=c,this},a(document).on("click.bs.button.data-api","[data-toggle^=button]",function(b){var c=a(b.target);c.hasClass("btn")||(c=c.closest(".btn")),c.button("toggle"),b.preventDefault()})}(window.jQuery),+function(a){"use strict";var b=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter",a.proxy(this.pause,this)).on("mouseleave",a.proxy(this.cycle,this))};b.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},b.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},b.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},b.prototype.to=function(b){var c=this,d=this.getActiveIndex();return b>this.$items.length-1||0>b?void 0:this.sliding?this.$element.one("slid",function(){c.to(b)}):d==b?this.pause().cycle():this.slide(b>d?"next":"prev",a(this.$items[b]))},b.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition.end&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},b.prototype.next=function(){return this.sliding?void 0:this.slide("next")},b.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},b.prototype.slide=function(b,c){var d=this.$element.find(".item.active"),e=c||d[b](),f=this.interval,g="next"==b?"left":"right",h="next"==b?"first":"last",i=this;if(!e.length){if(!this.options.wrap)return;e=this.$element.find(".item")[h]()}this.sliding=!0,f&&this.pause();var j=a.Event("slide.bs.carousel",{relatedTarget:e[0],direction:g});if(!e.hasClass("active")){if(this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid",function(){var b=a(i.$indicators.children()[i.getActiveIndex()]);b&&b.addClass("active")})),a.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(j),j.isDefaultPrevented())return;e.addClass(b),e[0].offsetWidth,d.addClass(g),e.addClass(g),d.one(a.support.transition.end,function(){e.removeClass([b,g].join(" ")).addClass("active"),d.removeClass(["active",g].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger("slid")},0)}).emulateTransitionEnd(600)}else{if(this.$element.trigger(j),j.isDefaultPrevented())return;d.removeClass("active"),e.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return f&&this.cycle(),this}};var c=a.fn.carousel;a.fn.carousel=function(c){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},b.DEFAULTS,d.data(),"object"==typeof c&&c),g="string"==typeof c?c:f.slide;e||d.data("bs.carousel",e=new b(this,f)),"number"==typeof c?e.to(c):g?e[g]():f.interval&&e.pause().cycle()})},a.fn.carousel.Constructor=b,a.fn.carousel.noConflict=function(){return a.fn.carousel=c,this},a(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(b){var c,d=a(this),e=a(d.attr("data-target")||(c=d.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"")),f=a.extend({},e.data(),d.data()),g=d.attr("data-slide-to");g&&(f.interval=!1),e.carousel(f),(g=d.attr("data-slide-to"))&&e.data("bs.carousel").to(g),b.preventDefault()}),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var b=a(this);b.carousel(b.data())})})}(window.jQuery),+function(a){"use strict";var b=function(c,d){this.$element=a(c),this.options=a.extend({},b.DEFAULTS,d),this.transitioning=null,this.options.parent&&(this.$parent=a(this.options.parent)),this.options.toggle&&this.toggle()};b.DEFAULTS={toggle:!0},b.prototype.dimension=function(){var a=this.$element.hasClass("width");return a?"width":"height"},b.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var b=a.Event("show.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.$parent&&this.$parent.find("> .panel > .in");if(c&&c.length){var d=c.data("bs.collapse");if(d&&d.transitioning)return;c.collapse("hide"),d||c.data("bs.collapse",null)}var e=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[e](0),this.transitioning=1;var f=function(){this.$element.removeClass("collapsing").addClass("in")[e]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return f.call(this);var g=a.camelCase(["scroll",e].join("-"));this.$element.one(a.support.transition.end,a.proxy(f,this)).emulateTransitionEnd(350)[e](this.$element[0][g])}}},b.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var d=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return a.support.transition?(this.$element[c](0).one(a.support.transition.end,a.proxy(d,this)).emulateTransitionEnd(350),void 0):d.call(this)}}},b.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var c=a.fn.collapse;a.fn.collapse=function(c){return this.each(function(){var d=a(this),e=d.data("bs.collapse"),f=a.extend({},b.DEFAULTS,d.data(),"object"==typeof c&&c);e||d.data("bs.collapse",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.collapse.Constructor=b,a.fn.collapse.noConflict=function(){return a.fn.collapse=c,this},a(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(b){var c,d=a(this),e=d.attr("data-target")||b.preventDefault()||(c=d.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,""),f=a(e),g=f.data("bs.collapse"),h=g?"toggle":d.data(),i=d.attr("data-parent"),j=i&&a(i);g&&g.transitioning||(j&&j.find('[data-toggle=collapse][data-parent="'+i+'"]').not(d).addClass("collapsed"),d[f.hasClass("in")?"addClass":"removeClass"]("collapsed")),f.collapse(h)})}(window.jQuery),+function(a){"use strict";function b(){a(d).remove(),a(e).each(function(b){var d=c(a(this));d.hasClass("open")&&(d.trigger(b=a.Event("hide.bs.dropdown")),b.isDefaultPrevented()||d.removeClass("open").trigger("hidden.bs.dropdown"))})}function c(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}var d=".dropdown-backdrop",e="[data-toggle=dropdown]",f=function(b){a(b).on("click.bs.dropdown",this.toggle)};f.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=c(e),g=f.hasClass("open");if(b(),!g){if("ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a('<div class="dropdown-backdrop"/>').insertAfter(a(this)).on("click",b),f.trigger(d=a.Event("show.bs.dropdown")),d.isDefaultPrevented())return;f.toggleClass("open").trigger("shown.bs.dropdown"),e.focus()}return!1}},f.prototype.keydown=function(b){if(/(38|40|27)/.test(b.keyCode)){var d=a(this);if(b.preventDefault(),b.stopPropagation(),!d.is(".disabled, :disabled")){var f=c(d),g=f.hasClass("open");if(!g||g&&27==b.keyCode)return 27==b.which&&f.find(e).focus(),d.click();var h=a("[role=menu] li:not(.divider):visible a",f);if(h.length){var i=h.index(h.filter(":focus"));38==b.keyCode&&i>0&&i--,40==b.keyCode&&i<h.length-1&&i++,~i||(i=0),h.eq(i).focus()}}}};var g=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var c=a(this),d=c.data("dropdown");d||c.data("dropdown",d=new f(this)),"string"==typeof b&&d[b].call(c)})},a.fn.dropdown.Constructor=f,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=g,this},a(document).on("click.bs.dropdown.data-api",b).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",e,f.prototype.toggle).on("keydown.bs.dropdown.data-api",e+", [role=menu]",f.prototype.keydown)}(window.jQuery),+function(a){"use strict";var b=function(b,c){this.options=c,this.$element=a(b),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.load(this.options.remote)};b.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},b.prototype.toggle=function(a){return this[this.isShown?"hide":"show"](a)},b.prototype.show=function(b){var c=this,d=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(d),this.isShown||d.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on("click.dismiss.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.backdrop(function(){var d=a.support.transition&&c.$element.hasClass("fade");c.$element.parent().length||c.$element.appendTo(document.body),c.$element.show(),d&&c.$element[0].offsetWidth,c.$element.addClass("in").attr("aria-hidden",!1),c.enforceFocus();var e=a.Event("shown.bs.modal",{relatedTarget:b});d?c.$element.find(".modal-dialog").one(a.support.transition.end,function(){c.$element.focus().trigger(e)}).emulateTransitionEnd(300):c.$element.focus().trigger(e)}))},b.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one(a.support.transition.end,a.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},b.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.focus()},this))},b.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},b.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.removeBackdrop(),a.$element.trigger("hidden.bs.modal")})},b.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},b.prototype.backdrop=function(b){var c=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var d=a.support.transition&&c;if(this.$backdrop=a('<div class="modal-backdrop '+c+'" />').appendTo(document.body),this.$element.on("click.dismiss.modal",a.proxy(function(a){a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),d&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;d?this.$backdrop.one(a.support.transition.end,b).emulateTransitionEnd(150):b()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(a.support.transition.end,b).emulateTransitionEnd(150):b()):b&&b()};var c=a.fn.modal;a.fn.modal=function(c,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},b.DEFAULTS,e.data(),"object"==typeof c&&c);f||e.data("bs.modal",f=new b(this,g)),"string"==typeof c?f[c](d):g.show&&f.show(d)})},a.fn.modal.Constructor=b,a.fn.modal.noConflict=function(){return a.fn.modal=c,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(b){var c=a(this),d=c.attr("href"),e=a(c.attr("data-target")||d&&d.replace(/.*(?=#[^\s]+$)/,"")),f=e.data("modal")?"toggle":a.extend({remote:!/#/.test(d)&&d},e.data(),c.data());b.preventDefault(),e.modal(f,this).one("hide",function(){c.is(":visible")&&c.focus()})}),a(document).on("show.bs.modal",".modal",function(){a(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){a(document.body).removeClass("modal-open")})}(window.jQuery),+function(a){"use strict";var b=function(a,b){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",a,b)};b.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},b.prototype.init=function(b,c,d){this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d);for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focus",i="hover"==g?"mouseleave":"blur";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},b.prototype.getDefaults=function(){return b.DEFAULTS},b.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},b.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},b.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show),void 0):c.show()},b.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide),void 0):c.hide()},b.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(b),b.isDefaultPrevented())return;var c=this.tip();this.setContent(),this.options.animation&&c.addClass("fade");var d="function"==typeof this.options.placement?this.options.placement.call(this,c[0],this.$element[0]):this.options.placement,e=/\s?auto?\s?/i,f=e.test(d);f&&(d=d.replace(e,"")||"top"),c.detach().css({top:0,left:0,display:"block"}).addClass(d),this.options.container?c.appendTo(this.options.container):c.insertAfter(this.$element);var g=this.getPosition(),h=c[0].offsetWidth,i=c[0].offsetHeight;if(f){var j=this.$element.parent(),k=d,l=document.documentElement.scrollTop||document.body.scrollTop,m="body"==this.options.container?window.innerWidth:j.outerWidth(),n="body"==this.options.container?window.innerHeight:j.outerHeight(),o="body"==this.options.container?0:j.offset().left;d="bottom"==d&&g.top+g.height+i-l>n?"top":"top"==d&&g.top-l-i<0?"bottom":"right"==d&&g.right+h>m?"left":"left"==d&&g.left-h<o?"right":d,c.removeClass(k).addClass(d)}var p=this.getCalculatedOffset(d,g,h,i);this.applyPlacement(p,d),this.$element.trigger("shown.bs."+this.type)}},b.prototype.applyPlacement=function(a,b){var c,d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),a.top=a.top+g,a.left=a.left+h,d.offset(a).addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;if("top"==b&&j!=f&&(c=!0,a.top=a.top+f-j),/bottom|top/.test(b)){var k=0;a.left<0&&(k=-2*a.left,a.left=0,d.offset(a),i=d[0].offsetWidth,j=d[0].offsetHeight),this.replaceArrow(k-e+i,i,"left")}else this.replaceArrow(j-f,j,"top");c&&d.offset(a)},b.prototype.replaceArrow=function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+"%":"")},b.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},b.prototype.hide=function(){function b(){"in"!=c.hoverState&&d.detach()}var c=this,d=this.tip(),e=a.Event("hide.bs."+this.type);return this.$element.trigger(e),e.isDefaultPrevented()?void 0:(d.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?d.one(a.support.transition.end,b).emulateTransitionEnd(150):b(),this.$element.trigger("hidden.bs."+this.type),this)},b.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},b.prototype.hasContent=function(){return this.getTitle()},b.prototype.getPosition=function(){var b=this.$element[0];return a.extend({},"function"==typeof b.getBoundingClientRect?b.getBoundingClientRect():{width:b.offsetWidth,height:b.offsetHeight},this.$element.offset())},b.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},b.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},b.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},b.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},b.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},b.prototype.enable=function(){this.enabled=!0},b.prototype.disable=function(){this.enabled=!1},b.prototype.toggleEnabled=function(){this.enabled=!this.enabled},b.prototype.toggle=function(b){var c=b?a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;c.tip().hasClass("in")?c.leave(c):c.enter(c)},b.prototype.destroy=function(){this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var c=a.fn.tooltip;a.fn.tooltip=function(c){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof c&&c;e||d.data("bs.tooltip",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.tooltip.Constructor=b,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=c,this}}(window.jQuery),+function(a){"use strict";var b=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");b.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),b.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),b.prototype.constructor=b,b.prototype.getDefaults=function(){return b.DEFAULTS},b.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content")[this.options.html?"html":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},b.prototype.hasContent=function(){return this.getTitle()||this.getContent()},b.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},b.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},b.prototype.tip=function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip};var c=a.fn.popover;a.fn.popover=function(c){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof c&&c;e||d.data("bs.popover",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.popover.Constructor=b,a.fn.popover.noConflict=function(){return a.fn.popover=c,this}}(window.jQuery),+function(a){"use strict";function b(c,d){var e,f=a.proxy(this.process,this);this.$element=a(c).is("body")?a(window):a(c),this.$body=a("body"),this.$scrollElement=this.$element.on("scroll.bs.scroll-spy.data-api",f),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||(e=a(c).attr("href"))&&e.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.offsets=a([]),this.targets=a([]),this.activeTarget=null,this.refresh(),this.process()}b.DEFAULTS={offset:10},b.prototype.refresh=function(){var b=this.$element[0]==window?"offset":"position";this.offsets=a([]),this.targets=a([]);var c=this;this.$body.find(this.selector).map(function(){var d=a(this),e=d.data("target")||d.attr("href"),f=/^#\w/.test(e)&&a(e);return f&&f.length&&[[f[b]().top+(!a.isWindow(c.$scrollElement.get(0))&&c.$scrollElement.scrollTop()),e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){c.offsets.push(this[0]),c.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,d=c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(b>=d)return g!=(a=f.last()[0])&&this.activate(a);for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(!e[a+1]||b<=e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,a(this.selector).parents(".active").removeClass("active");var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate")};var c=a.fn.scrollspy;a.fn.scrollspy=function(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=c,this},a(window).on("load",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);b.scrollspy(b.data())})})}(window.jQuery),+function(a){"use strict";var b=function(b){this.element=a(b)};b.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.attr("data-target");if(d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a")[0],f=a.Event("show.bs.tab",{relatedTarget:e});if(b.trigger(f),!f.isDefaultPrevented()){var g=a(d);this.activate(b.parent("li"),c),this.activate(g,g.parent(),function(){b.trigger({type:"shown.bs.tab",relatedTarget:e})})}}},b.prototype.activate=function(b,c,d){function e(){f.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),b.addClass("active"),g?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active"),d&&d()}var f=c.find("> .active"),g=d&&a.support.transition&&f.hasClass("fade");g?f.one(a.support.transition.end,e).emulateTransitionEnd(150):e(),f.removeClass("in")};var c=a.fn.tab;a.fn.tab=function(c){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new b(this)),"string"==typeof c&&e[c]()})},a.fn.tab.Constructor=b,a.fn.tab.noConflict=function(){return a.fn.tab=c,this},a(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(b){b.preventDefault(),a(this).tab("show")})}(window.jQuery),+function(a){"use strict";var b=function(c,d){this.options=a.extend({},b.DEFAULTS,d),this.$window=a(window).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(c),this.affixed=this.unpin=null,this.checkPosition()};b.RESET="affix affix-top affix-bottom",b.DEFAULTS={offset:0},b.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},b.prototype.checkPosition=function(){if(this.$element.is(":visible")){var c=a(document).height(),d=this.$window.scrollTop(),e=this.$element.offset(),f=this.options.offset,g=f.top,h=f.bottom;"object"!=typeof f&&(h=g=f),"function"==typeof g&&(g=f.top()),"function"==typeof h&&(h=f.bottom());var i=null!=this.unpin&&d+this.unpin<=e.top?!1:null!=h&&e.top+this.$element.height()>=c-h?"bottom":null!=g&&g>=d?"top":!1;this.affixed!==i&&(this.unpin&&this.$element.css("top",""),this.affixed=i,this.unpin="bottom"==i?e.top-d:null,this.$element.removeClass(b.RESET).addClass("affix"+(i?"-"+i:"")),"bottom"==i&&this.$element.offset({top:document.body.offsetHeight-h-this.$element.height()}))}};var c=a.fn.affix;a.fn.affix=function(c){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof c&&c;e||d.data("bs.affix",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.affix.Constructor=b,a.fn.affix.noConflict=function(){return a.fn.affix=c,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var b=a(this),c=b.data();c.offset=c.offset||{},c.offsetBottom&&(c.offset.bottom=c.offsetBottom),c.offsetTop&&(c.offset.top=c.offsetTop),b.affix(c)})})}(window.jQuery),function(a){var b="0.9.3",c={isMsie:function(){var a=/(msie) ([\w.]+)/i.exec(navigator.userAgent);return a?parseInt(a[2],10):!1},isBlankString:function(a){return!a||/^\s*$/.test(a)},escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isArray:a.isArray,isFunction:a.isFunction,isObject:a.isPlainObject,isUndefined:function(a){return"undefined"==typeof a},bind:a.proxy,bindAll:function(b){var c;for(var d in b)a.isFunction(c=b[d])&&(b[d]=a.proxy(c,b))},indexOf:function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},each:a.each,map:a.map,filter:a.grep,every:function(b,c){var d=!0;return b?(a.each(b,function(a,e){return(d=c.call(null,e,a,b))?void 0:!1}),!!d):d},some:function(b,c){var d=!1;return b?(a.each(b,function(a,e){return(d=c.call(null,e,a,b))?!1:void 0}),!!d):d},mixin:a.extend,getUniqueId:function(){var a=0;return function(){return a++}}(),defer:function(a){setTimeout(a,0)},debounce:function(a,b,c){var d,e;return function(){var f,g,h=this,i=arguments;return f=function(){d=null,c||(e=a.apply(h,i))},g=c&&!d,clearTimeout(d),d=setTimeout(f,b),g&&(e=a.apply(h,i)),e}},throttle:function(a,b){var c,d,e,f,g,h;return g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)},function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},tokenizeQuery:function(b){return a.trim(b).toLowerCase().split(/[\s]+/)},tokenizeText:function(b){return a.trim(b).toLowerCase().split(/[\s\-_]+/)},getProtocol:function(){return location.protocol},noop:function(){}},d=function(){var a=/\s+/;return{on:function(b,c){var d;if(!c)return this;for(this._callbacks=this._callbacks||{},b=b.split(a);d=b.shift();)this._callbacks[d]=this._callbacks[d]||[],this._callbacks[d].push(c);return this},trigger:function(b,c){var d,e;if(!this._callbacks)return this;for(b=b.split(a);d=b.shift();)if(e=this._callbacks[d])for(var f=0;f<e.length;f+=1)e[f].call(this,{type:d,data:c});return this}}}(),e=function(){function b(b){b&&b.el||a.error("EventBus initialized without el"),this.$el=a(b.el)}var d="typeahead:";return c.mixin(b.prototype,{trigger:function(a){var b=[].slice.call(arguments,1);this.$el.trigger(d+a,b)}}),b}(),f=function(){function a(a){this.prefix=["__",a,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+this.prefix)}function b(){return(new Date).getTime()}function d(a){return JSON.stringify(c.isUndefined(a)?null:a)}function e(a){return JSON.parse(a)}var f,g;try{f=window.localStorage,f.setItem("~~~","!"),f.removeItem("~~~")}catch(h){f=null}return g=f&&window.JSON?{_prefix:function(a){return this.prefix+a},_ttlKey:function(a){return this._prefix(a)+this.ttlKey},get:function(a){return this.isExpired(a)&&this.remove(a),e(f.getItem(this._prefix(a)))},set:function(a,e,g){return c.isNumber(g)?f.setItem(this._ttlKey(a),d(b()+g)):f.removeItem(this._ttlKey(a)),f.setItem(this._prefix(a),d(e))},remove:function(a){return f.removeItem(this._ttlKey(a)),f.removeItem(this._prefix(a)),this},clear:function(){var a,b,c=[],d=f.length;for(a=0;d>a;a++)(b=f.key(a)).match(this.keyMatcher)&&c.push(b.replace(this.keyMatcher,""));for(a=c.length;a--;)this.remove(c[a]);return this},isExpired:function(a){var d=e(f.getItem(this._ttlKey(a)));return c.isNumber(d)&&b()>d?!0:!1}}:{get:c.noop,set:c.noop,remove:c.noop,clear:c.noop,isExpired:c.noop},c.mixin(a.prototype,g),a}(),g=function(){function a(a){c.bindAll(this),a=a||{},this.sizeLimit=a.sizeLimit||10,this.cache={},this.cachedKeysByAge=[]}return c.mixin(a.prototype,{get:function(a){return this.cache[a]},set:function(a,b){var c;this.cachedKeysByAge.length===this.sizeLimit&&(c=this.cachedKeysByAge.shift(),delete this.cache[c]),this.cache[a]=b,this.cachedKeysByAge.push(a)}}),a}(),h=function(){function b(a){c.bindAll(this),a=c.isString(a)?{url:a}:a,i=i||new g,h=c.isNumber(a.maxParallelRequests)?a.maxParallelRequests:h||6,this.url=a.url,this.wildcard=a.wildcard||"%QUERY",this.filter=a.filter,this.replace=a.replace,this.ajaxSettings={type:"get",cache:a.cache,timeout:a.timeout,dataType:a.dataType||"json",beforeSend:a.beforeSend},this._get=(/^throttle$/i.test(a.rateLimitFn)?c.throttle:c.debounce)(this._get,a.rateLimitWait||300)}function d(){j++}function e(){j--}function f(){return h>j}var h,i,j=0,k={};return c.mixin(b.prototype,{_get:function(a,b){function c(c){var e=d.filter?d.filter(c):c;
b&&b(e),i.set(a,c)}var d=this;f()?this._sendRequest(a).done(c):this.onDeckRequestArgs=[].slice.call(arguments,0)},_sendRequest:function(b){function c(){e(),k[b]=null,f.onDeckRequestArgs&&(f._get.apply(f,f.onDeckRequestArgs),f.onDeckRequestArgs=null)}var f=this,g=k[b];return g||(d(),g=k[b]=a.ajax(b,this.ajaxSettings).always(c)),g},get:function(a,b){var d,e,f=this,g=encodeURIComponent(a||"");return b=b||c.noop,d=this.replace?this.replace(this.url,g):this.url.replace(this.wildcard,g),(e=i.get(d))?c.defer(function(){b(f.filter?f.filter(e):e)}):this._get(d,b),!!e}}),b}(),i=function(){function d(b){c.bindAll(this),c.isString(b.template)&&!b.engine&&a.error("no template engine specified"),b.local||b.prefetch||b.remote||a.error("one of local, prefetch, or remote is required"),this.name=b.name||c.getUniqueId(),this.limit=b.limit||5,this.minLength=b.minLength||1,this.header=b.header,this.footer=b.footer,this.valueKey=b.valueKey||"value",this.template=e(b.template,b.engine,this.valueKey),this.local=b.local,this.prefetch=b.prefetch,this.remote=b.remote,this.itemHash={},this.adjacencyList={},this.storage=b.name?new f(b.name):null}function e(a,b,d){var e,f;return c.isFunction(a)?e=a:c.isString(a)?(f=b.compile(a),e=c.bind(f.render,f)):e=function(a){return"<p>"+a[d]+"</p>"},e}var g={thumbprint:"thumbprint",protocol:"protocol",itemHash:"itemHash",adjacencyList:"adjacencyList"};return c.mixin(d.prototype,{_processLocalData:function(a){this._mergeProcessedData(this._processData(a))},_loadPrefetchData:function(d){function e(a){var b=d.filter?d.filter(a):a,e=m._processData(b),f=e.itemHash,h=e.adjacencyList;m.storage&&(m.storage.set(g.itemHash,f,d.ttl),m.storage.set(g.adjacencyList,h,d.ttl),m.storage.set(g.thumbprint,n,d.ttl),m.storage.set(g.protocol,c.getProtocol(),d.ttl)),m._mergeProcessedData(e)}var f,h,i,j,k,l,m=this,n=b+(d.thumbprint||"");return this.storage&&(f=this.storage.get(g.thumbprint),h=this.storage.get(g.protocol),i=this.storage.get(g.itemHash),j=this.storage.get(g.adjacencyList)),k=f!==n||h!==c.getProtocol(),d=c.isString(d)?{url:d}:d,d.ttl=c.isNumber(d.ttl)?d.ttl:864e5,i&&j&&!k?(this._mergeProcessedData({itemHash:i,adjacencyList:j}),l=a.Deferred().resolve()):l=a.getJSON(d.url).done(e),l},_transformDatum:function(a){var b=c.isString(a)?a:a[this.valueKey],d=a.tokens||c.tokenizeText(b),e={value:b,tokens:d};return c.isString(a)?(e.datum={},e.datum[this.valueKey]=a):e.datum=a,e.tokens=c.filter(e.tokens,function(a){return!c.isBlankString(a)}),e.tokens=c.map(e.tokens,function(a){return a.toLowerCase()}),e},_processData:function(a){var b=this,d={},e={};return c.each(a,function(a,f){var g=b._transformDatum(f),h=c.getUniqueId(g.value);d[h]=g,c.each(g.tokens,function(a,b){var d=b.charAt(0),f=e[d]||(e[d]=[h]);!~c.indexOf(f,h)&&f.push(h)})}),{itemHash:d,adjacencyList:e}},_mergeProcessedData:function(a){var b=this;c.mixin(this.itemHash,a.itemHash),c.each(a.adjacencyList,function(a,c){var d=b.adjacencyList[a];b.adjacencyList[a]=d?d.concat(c):c})},_getLocalSuggestions:function(a){var b,d=this,e=[],f=[],g=[];return c.each(a,function(a,b){var d=b.charAt(0);!~c.indexOf(e,d)&&e.push(d)}),c.each(e,function(a,c){var e=d.adjacencyList[c];return e?(f.push(e),(!b||e.length<b.length)&&(b=e),void 0):!1}),f.length<e.length?[]:(c.each(b,function(b,e){var h,i,j=d.itemHash[e];h=c.every(f,function(a){return~c.indexOf(a,e)}),i=h&&c.every(a,function(a){return c.some(j.tokens,function(b){return 0===b.indexOf(a)})}),i&&g.push(j)}),g)},initialize:function(){var b;return this.local&&this._processLocalData(this.local),this.transport=this.remote?new h(this.remote):null,b=this.prefetch?this._loadPrefetchData(this.prefetch):a.Deferred().resolve(),this.local=this.prefetch=this.remote=null,this.initialize=function(){return b},b},getSuggestions:function(a,b){function d(a){f=f.slice(0),c.each(a,function(a,b){var d,e=g._transformDatum(b);return d=c.some(f,function(a){return e.value===a.value}),!d&&f.push(e),f.length<g.limit}),b&&b(f)}var e,f,g=this,h=!1;a.length<this.minLength||(e=c.tokenizeQuery(a),f=this._getLocalSuggestions(e).slice(0,this.limit),f.length<this.limit&&this.transport&&(h=this.transport.get(a,d)),!h&&b&&b(f))}}),d}(),j=function(){function b(b){var d=this;c.bindAll(this),this.specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},this.$hint=a(b.hint),this.$input=a(b.input).on("blur.tt",this._handleBlur).on("focus.tt",this._handleFocus).on("keydown.tt",this._handleSpecialKeyEvent),c.isMsie()?this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(a){d.specialKeyCodeMap[a.which||a.keyCode]||c.defer(d._compareQueryToInputValue)}):this.$input.on("input.tt",this._compareQueryToInputValue),this.query=this.$input.val(),this.$overflowHelper=e(this.$input)}function e(b){return a("<span></span>").css({position:"absolute",left:"-9999px",visibility:"hidden",whiteSpace:"nowrap",fontFamily:b.css("font-family"),fontSize:b.css("font-size"),fontStyle:b.css("font-style"),fontVariant:b.css("font-variant"),fontWeight:b.css("font-weight"),wordSpacing:b.css("word-spacing"),letterSpacing:b.css("letter-spacing"),textIndent:b.css("text-indent"),textRendering:b.css("text-rendering"),textTransform:b.css("text-transform")}).insertAfter(b)}function f(a,b){return a=(a||"").replace(/^\s*/g,"").replace(/\s{2,}/g," "),b=(b||"").replace(/^\s*/g,"").replace(/\s{2,}/g," "),a===b}return c.mixin(b.prototype,d,{_handleFocus:function(){this.trigger("focused")},_handleBlur:function(){this.trigger("blured")},_handleSpecialKeyEvent:function(a){var b=this.specialKeyCodeMap[a.which||a.keyCode];b&&this.trigger(b+"Keyed",a)},_compareQueryToInputValue:function(){var a=this.getInputValue(),b=f(this.query,a),c=b?this.query.length!==a.length:!1;c?this.trigger("whitespaceChanged",{value:this.query}):b||this.trigger("queryChanged",{value:this.query=a})},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$hint=this.$input=this.$overflowHelper=null},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(a){this.query=a},getInputValue:function(){return this.$input.val()},setInputValue:function(a,b){this.$input.val(a),!b&&this._compareQueryToInputValue()},getHintValue:function(){return this.$hint.val()},setHintValue:function(a){this.$hint.val(a)},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},isOverflow:function(){return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>this.$input.width()},isCursorAtEnd:function(){var a,b=this.$input.val().length,d=this.$input[0].selectionStart;return c.isNumber(d)?d===b:document.selection?(a=document.selection.createRange(),a.moveStart("character",-b),b===a.text.length):!0}}),b}(),k=function(){function b(b){c.bindAll(this),this.isOpen=!1,this.isEmpty=!0,this.isMouseOverDropdown=!1,this.$menu=a(b.menu).on("mouseenter.tt",this._handleMouseenter).on("mouseleave.tt",this._handleMouseleave).on("click.tt",".tt-suggestion",this._handleSelection).on("mouseover.tt",".tt-suggestion",this._handleMouseover)}function e(a){return a.data("suggestion")}var f={suggestionsList:'<span class="tt-suggestions"></span>'},g={suggestionsList:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"}};return c.mixin(b.prototype,d,{_handleMouseenter:function(){this.isMouseOverDropdown=!0},_handleMouseleave:function(){this.isMouseOverDropdown=!1},_handleMouseover:function(b){var c=a(b.currentTarget);this._getSuggestions().removeClass("tt-is-under-cursor"),c.addClass("tt-is-under-cursor")},_handleSelection:function(b){var c=a(b.currentTarget);this.trigger("suggestionSelected",e(c))},_show:function(){this.$menu.css("display","block")},_hide:function(){this.$menu.hide()},_moveCursor:function(a){var b,c,d,f;if(this.isVisible()){if(b=this._getSuggestions(),c=b.filter(".tt-is-under-cursor"),c.removeClass("tt-is-under-cursor"),d=b.index(c)+a,d=(d+1)%(b.length+1)-1,-1===d)return this.trigger("cursorRemoved"),void 0;-1>d&&(d=b.length-1),f=b.eq(d).addClass("tt-is-under-cursor"),this._ensureVisibility(f),this.trigger("cursorMoved",e(f))}},_getSuggestions:function(){return this.$menu.find(".tt-suggestions > .tt-suggestion")},_ensureVisibility:function(a){var b=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),c=this.$menu.scrollTop(),d=a.position().top,e=d+a.outerHeight(!0);0>d?this.$menu.scrollTop(c+d):e>b&&this.$menu.scrollTop(c+(e-b))},destroy:function(){this.$menu.off(".tt"),this.$menu=null},isVisible:function(){return this.isOpen&&!this.isEmpty},closeUnlessMouseIsOverDropdown:function(){this.isMouseOverDropdown||this.close()},close:function(){this.isOpen&&(this.isOpen=!1,this.isMouseOverDropdown=!1,this._hide(),this.$menu.find(".tt-suggestions > .tt-suggestion").removeClass("tt-is-under-cursor"),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(a){var b={left:"0",right:"auto"},c={left:"auto",right:" 0"};"ltr"===a?this.$menu.css(b):this.$menu.css(c)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getSuggestionUnderCursor:function(){var a=this._getSuggestions().filter(".tt-is-under-cursor").first();return a.length>0?e(a):null},getFirstSuggestion:function(){var a=this._getSuggestions().first();return a.length>0?e(a):null},renderSuggestions:function(b,d){var e,h,i,j,k,l="tt-dataset-"+b.name,m='<div class="tt-suggestion">%body</div>',n=this.$menu.find("."+l);0===n.length&&(h=a(f.suggestionsList).css(g.suggestionsList),n=a("<div></div>").addClass(l).append(b.header).append(h).append(b.footer).appendTo(this.$menu)),d.length>0?(this.isEmpty=!1,this.isOpen&&this._show(),i=document.createElement("div"),j=document.createDocumentFragment(),c.each(d,function(c,d){d.dataset=b.name,e=b.template(d.datum),i.innerHTML=m.replace("%body",e),k=a(i.firstChild).css(g.suggestion).data("suggestion",d),k.children().each(function(){a(this).css(g.suggestionChild)}),j.appendChild(k[0])}),n.show().find(".tt-suggestions").html(j)):this.clearSuggestions(b.name),this.trigger("suggestionsRendered")},clearSuggestions:function(a){var b=a?this.$menu.find(".tt-dataset-"+a):this.$menu.find('[class^="tt-dataset-"]'),c=b.find(".tt-suggestions");b.hide(),c.empty(),0===this._getSuggestions().length&&(this.isEmpty=!0,this._hide())}}),b}(),l=function(){function b(a){var b,d,f;c.bindAll(this),this.$node=e(a.input),this.datasets=a.datasets,this.dir=null,this.eventBus=a.eventBus,b=this.$node.find(".tt-dropdown-menu"),d=this.$node.find(".tt-query"),f=this.$node.find(".tt-hint"),this.dropdownView=new k({menu:b}).on("suggestionSelected",this._handleSelection).on("cursorMoved",this._clearHint).on("cursorMoved",this._setInputValueToSuggestionUnderCursor).on("cursorRemoved",this._setInputValueToQuery).on("cursorRemoved",this._updateHint).on("suggestionsRendered",this._updateHint).on("opened",this._updateHint).on("closed",this._clearHint).on("opened closed",this._propagateEvent),this.inputView=new j({input:d,hint:f}).on("focused",this._openDropdown).on("blured",this._closeDropdown).on("blured",this._setInputValueToQuery).on("enterKeyed tabKeyed",this._handleSelection).on("queryChanged",this._clearHint).on("queryChanged",this._clearSuggestions).on("queryChanged",this._getSuggestions).on("whitespaceChanged",this._updateHint).on("queryChanged whitespaceChanged",this._openDropdown).on("queryChanged whitespaceChanged",this._setLanguageDirection).on("escKeyed",this._closeDropdown).on("escKeyed",this._setInputValueToQuery).on("tabKeyed upKeyed downKeyed",this._managePreventDefault).on("upKeyed downKeyed",this._moveDropdownCursor).on("upKeyed downKeyed",this._openDropdown).on("tabKeyed leftKeyed rightKeyed",this._autocomplete)}function e(b){var c=a(g.wrapper),d=a(g.dropdown),e=a(b),f=a(g.hint);c=c.css(h.wrapper),d=d.css(h.dropdown),f.css(h.hint).css({backgroundAttachment:e.css("background-attachment"),backgroundClip:e.css("background-clip"),backgroundColor:e.css("background-color"),backgroundImage:e.css("background-image"),backgroundOrigin:e.css("background-origin"),backgroundPosition:e.css("background-position"),backgroundRepeat:e.css("background-repeat"),backgroundSize:e.css("background-size")}),e.data("ttAttrs",{dir:e.attr("dir"),autocomplete:e.attr("autocomplete"),spellcheck:e.attr("spellcheck"),style:e.attr("style")}),e.addClass("tt-query").attr({autocomplete:"off",spellcheck:!1}).css(h.query);try{!e.attr("dir")&&e.attr("dir","auto")}catch(i){}return e.wrap(c).parent().prepend(f).append(d)}function f(a){var b=a.find(".tt-query");c.each(b.data("ttAttrs"),function(a,d){c.isUndefined(d)?b.removeAttr(a):b.attr(a,d)}),b.detach().removeData("ttAttrs").removeClass("tt-query").insertAfter(a),a.remove()}var g={wrapper:'<span class="twitter-typeahead"></span>',hint:'<input class="tt-hint" type="text" autocomplete="off" spellcheck="off" disabled>',dropdown:'<span class="tt-dropdown-menu"></span>'},h={wrapper:{position:"relative"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"},query:{position:"relative",verticalAlign:"top","border-radius":"4px 0 0 4px","-moz-border-radius":"4px 0 0 4px","-webkit-border-radius":"4px 0 0 4px"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"}};return c.isMsie()&&c.mixin(h.query,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),c.isMsie()&&c.isMsie()<=7&&(c.mixin(h.wrapper,{display:"inline",zoom:"1"}),c.mixin(h.query,{marginTop:"-1px"})),c.mixin(b.prototype,d,{_managePreventDefault:function(a){var b,c,d=a.data,e=!1;switch(a.type){case"tabKeyed":b=this.inputView.getHintValue(),c=this.inputView.getInputValue(),e=b&&b!==c;break;case"upKeyed":case"downKeyed":e=!d.shiftKey&&!d.ctrlKey&&!d.metaKey}e&&d.preventDefault()},_setLanguageDirection:function(){var a=this.inputView.getLanguageDirection();a!==this.dir&&(this.dir=a,this.$node.css("direction",a),this.dropdownView.setLanguageDirection(a))},_updateHint:function(){var a,b,d,e,f,g=this.dropdownView.getFirstSuggestion(),h=g?g.value:null,i=this.dropdownView.isVisible(),j=this.inputView.isOverflow();h&&i&&!j&&(a=this.inputView.getInputValue(),b=a.replace(/\s{2,}/g," ").replace(/^\s+/g,""),d=c.escapeRegExChars(b),e=new RegExp("^(?:"+d+")(.*$)","i"),f=e.exec(h),this.inputView.setHintValue(a+(f?f[1]:"")))},_clearHint:function(){this.inputView.setHintValue("")},_clearSuggestions:function(){this.dropdownView.clearSuggestions()},_setInputValueToQuery:function(){this.inputView.setInputValue(this.inputView.getQuery())},_setInputValueToSuggestionUnderCursor:function(a){var b=a.data;this.inputView.setInputValue(b.value,!0)},_openDropdown:function(){this.dropdownView.open()},_closeDropdown:function(a){this.dropdownView["blured"===a.type?"closeUnlessMouseIsOverDropdown":"close"]()},_moveDropdownCursor:function(a){var b=a.data;b.shiftKey||b.ctrlKey||b.metaKey||this.dropdownView["upKeyed"===a.type?"moveCursorUp":"moveCursorDown"]()},_handleSelection:function(a){var b="suggestionSelected"===a.type,d=b?a.data:this.dropdownView.getSuggestionUnderCursor();d&&(this.inputView.setInputValue(d.value),b?this.inputView.focus():a.data.preventDefault(),b&&c.isMsie()?c.defer(this.dropdownView.close):this.dropdownView.close(),this.eventBus.trigger("selected",d.datum,d.dataset))},_getSuggestions:function(){var a=this,b=this.inputView.getQuery();c.isBlankString(b)||c.each(this.datasets,function(c,d){d.getSuggestions(b,function(c){b===a.inputView.getQuery()&&a.dropdownView.renderSuggestions(d,c)})})},_autocomplete:function(a){var b,c,d,e,f;("rightKeyed"!==a.type&&"leftKeyed"!==a.type||(b=this.inputView.isCursorAtEnd(),c="ltr"===this.inputView.getLanguageDirection()?"leftKeyed"===a.type:"rightKeyed"===a.type,b&&!c))&&(d=this.inputView.getQuery(),e=this.inputView.getHintValue(),""!==e&&d!==e&&(f=this.dropdownView.getFirstSuggestion(),this.inputView.setInputValue(f.value),this.eventBus.trigger("autocompleted",f.datum,f.dataset)))},_propagateEvent:function(a){this.eventBus.trigger(a.type)},destroy:function(){this.inputView.destroy(),this.dropdownView.destroy(),f(this.$node),this.$node=null},setQuery:function(a){this.inputView.setQuery(a),this.inputView.setInputValue(a),this._clearHint(),this._clearSuggestions(),this._getSuggestions()}}),b}();!function(){var b,d={},f="ttView";b={initialize:function(b){function g(){var b,d=a(this),g=new e({el:d});b=c.map(h,function(a){return a.initialize()}),d.data(f,new l({input:d,eventBus:g=new e({el:d}),datasets:h})),a.when.apply(a,b).always(function(){c.defer(function(){g.trigger("initialized")})})}var h;return b=c.isArray(b)?b:[b],0===b.length&&a.error("no datasets provided"),h=c.map(b,function(a){var b=d[a.name]?d[a.name]:new i(a);return a.name&&(d[a.name]=b),b}),this.each(g)},destroy:function(){function b(){var b=a(this),c=b.data(f);c&&(c.destroy(),b.removeData(f))}return this.each(b)},setQuery:function(b){function c(){var c=a(this).data(f);c&&c.setQuery(b)}return this.each(c)}},jQuery.fn.typeahead=function(a){return b[a]?b[a].apply(this,[].slice.call(arguments,1)):b.initialize.apply(this,arguments)}}()}(window.jQuery),function(a,b){if("object"==typeof exports&&exports)b(exports);else{var c={};b(c),"function"==typeof define&&define.amd?define(c):a.Mustache=c}}(this,function(a){function b(a,b){return t.call(a,b)}function c(a){return!b(p,a)}function d(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function e(a){return String(a).replace(/[&<>"'\/]/g,function(a){return w[a]})}function f(a){this.string=a,this.tail=a,this.pos=0}function g(a,b){this.view=a||{},this.parent=b,this._cache={}}function h(){this.clearCache()}function i(b,c,d,e){for(var f,g,h,j="",k=0,l=b.length;l>k;++k)switch(f=b[k],g=f[1],f[0]){case"#":if(h=d.lookup(g),"object"==typeof h)if(v(h))for(var m=0,n=h.length;n>m;++m)j+=i(f[4],c,d.push(h[m]),e);else h&&(j+=i(f[4],c,d.push(h),e));else if("function"==typeof h){var o=null==e?null:e.slice(f[3],f[5]);h=h.call(d.view,o,function(a){return c.render(a,d)}),null!=h&&(j+=h)}else h&&(j+=i(f[4],c,d,e));break;case"^":h=d.lookup(g),(!h||v(h)&&0===h.length)&&(j+=i(f[4],c,d,e));break;case">":h=c.getPartial(g),"function"==typeof h&&(j+=h(d));break;case"&":h=d.lookup(g),null!=h&&(j+=h);break;case"name":h=d.lookup(g),null!=h&&(j+=a.escape(h));break;case"text":j+=g}return j}function j(a){for(var b,c=[],d=c,e=[],f=0,g=a.length;g>f;++f)switch(b=a[f],b[0]){case"#":case"^":e.push(b),d.push(b),d=b[4]=[];break;case"/":var h=e.pop();h[5]=b[2],d=e.length>0?e[e.length-1][4]:c;break;default:d.push(b)}return c}function k(a){for(var b,c,d=[],e=0,f=a.length;f>e;++e)b=a[e],b&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(c=b,d.push(b)));return d}function l(a){return[new RegExp(d(a[0])+"\\s*"),new RegExp("\\s*"+d(a[1]))]}function m(b,e){function g(){if(z&&!A)for(;y.length;)delete x[y.pop()];else y=[];z=!1,A=!1}if(b=b||"",e=e||a.tags,"string"==typeof e&&(e=e.split(o)),2!==e.length)throw new Error("Invalid tags: "+e.join(", "));for(var h,i,m,p,t,u=l(e),v=new f(b),w=[],x=[],y=[],z=!1,A=!1;!v.eos();){if(h=v.pos,m=v.scanUntil(u[0]))for(var B=0,C=m.length;C>B;++B)p=m.charAt(B),c(p)?y.push(x.length):A=!0,x.push(["text",p,h,h+1]),h+=1,"\n"==p&&g();if(!v.scan(u[0]))break;if(z=!0,i=v.scan(s)||"name",v.scan(n),"="===i?(m=v.scanUntil(q),v.scan(q),v.scanUntil(u[1])):"{"===i?(m=v.scanUntil(new RegExp("\\s*"+d("}"+e[1]))),v.scan(r),v.scanUntil(u[1]),i="&"):m=v.scanUntil(u[1]),!v.scan(u[1]))throw new Error("Unclosed tag at "+v.pos);if(t=[i,m,h,v.pos],x.push(t),"#"===i||"^"===i)w.push(t);else if("/"===i){if(0===w.length)throw new Error('Unopened section "'+m+'" at '+h);var D=w.pop();if(D[1]!==m)throw new Error('Unclosed section "'+D[1]+'" at '+h)}else if("name"===i||"{"===i||"&"===i)A=!0;else if("="===i){if(e=m.split(o),2!==e.length)throw new Error("Invalid tags at "+h+": "+e.join(", "));u=l(e)}}var D=w.pop();if(D)throw new Error('Unclosed section "'+D[1]+'" at '+v.pos);return x=k(x),j(x)}var n=/\s*/,o=/\s+/,p=/\S/,q=/\s*=/,r=/\s*\}/,s=/#|\^|\/|>|\{|&|=|!/,t=RegExp.prototype.test,u=Object.prototype.toString,v=Array.isArray||function(a){return"[object Array]"===u.call(a)},w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};f.prototype.eos=function(){return""===this.tail},f.prototype.scan=function(a){var b=this.tail.match(a);return b&&0===b.index?(this.tail=this.tail.substring(b[0].length),this.pos+=b[0].length,b[0]):""},f.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c),this.pos+=c}return b},g.make=function(a){return a instanceof g?a:new g(a)},g.prototype.push=function(a){return new g(a,this)},g.prototype.lookup=function(a){var b=this._cache[a];if(!b){if("."==a)b=this.view;else for(var c=this;c;){if(a.indexOf(".")>0){b=c.view;for(var d=a.split("."),e=0;b&&e<d.length;)b=b[d[e++]]}else b=c.view[a];if(null!=b)break;c=c.parent}this._cache[a]=b}return"function"==typeof b&&(b=b.call(this.view)),b},h.prototype.clearCache=function(){this._cache={},this._partialCache={}},h.prototype.compile=function(b,c){var d=this._cache[b];if(!d){var e=a.parse(b,c);d=this._cache[b]=this.compileTokens(e,b)}return d},h.prototype.compilePartial=function(a,b,c){var d=this.compile(b,c);return this._partialCache[a]=d,d},h.prototype.getPartial=function(a){return a in this._partialCache||!this._loadPartial||this.compilePartial(a,this._loadPartial(a)),this._partialCache[a]},h.prototype.compileTokens=function(a,b){var c=this;return function(d,e){if(e)if("function"==typeof e)c._loadPartial=e;else for(var f in e)c.compilePartial(f,e[f]);return i(a,c,g.make(d),b)}},h.prototype.render=function(a,b,c){return this.compile(a)(b,c)},a.name="mustache.js",a.version="0.7.2",a.tags=["{{","}}"],a.Scanner=f,a.Context=g,a.Writer=h,a.parse=m,a.escape=e;var x=new h;a.clearCache=function(){return x.clearCache()},a.compile=function(a,b){return x.compile(a,b)},a.compilePartial=function(a,b,c){return x.compilePartial(a,b,c)},a.compileTokens=function(a,b){return x.compileTokens(a,b)},a.render=function(a,b,c){return x.render(a,b,c)},a.to_html=function(b,c,d,e){var f=a.render(b,c,d);return"function"!=typeof e?f:(e(f),void 0)}}),d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.dblTap=function(a){var b=0;return this.each(function(){d3.select(this).on("touchstart",function(c){return d3.event.timeStamp-b<2e3?a(c):(b=d3.event.timeStamp,void 0)})})};var timeScale=function(){function clickcancel(){function a(a){function c(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2),Math.pow(a[1]-b[1],2))}var d,e,f=5,g=null;a.on("mousedown",function(){d=d3.mouse(document.body),e=+new Date}),a.on("mouseup",function(){c(d,d3.mouse(document.body))>f||(g?(window.clearTimeout(g),g=null,b.dblclick(d3.event)):g=window.setTimeout(function(a){return function(){b.click(a),g=null}}(d3.event),300))})}var b=d3.dispatch("click","dblclick");return d3.rebind(a,b,"on")}var data={oid:0,col:"#000000",nam:"Geologic Time",children:[]},interval_hash={0:data},currentInterval,dragStart,transformStart;return{init:function(a){var b=960,c=130,d=d3.scale.linear().range([0,b-5]),e=d3.scale.linear().range([0,c]),f=.01,g=d3.behavior.drag().origin(function(){d3.select(".timeScale g");return{x:-f,y:0}}).on("dragstart",function(){dragStart=[d3.event.sourceEvent.pageX,d3.event.sourceEvent.pageY],transformStart=d3.transform(d3.select(".timeScale").select("g").attr("transform")).translate,d3.event.sourceEvent.stopPropagation()}).on("drag",function(){var a=[d3.event.sourceEvent.pageX,d3.event.sourceEvent.pageY];f=dragStart[0]-a[0],d3.select(".timeScale").select("g").attr("transform",function(){return"translate("+[parseInt(transformStart[0]+-f),0]+")scale("+parseInt(d3.select(".timeScale").style("width"))/961+")"})});d3.select("#"+a).attr("class","timeScale");var h=d3.select("#"+a).append("svg:svg").attr("width",b).attr("height",c).append("g"),i=h.append("g").attr("id","tickBar").attr("transform","translate(0,125)");d3.json(paleo_nav.baseUrl+"/data1.1/intervals/list.json?scale=1&order=older&max_ma=4000",function(a,b){for(var c=0;c<b.records.length;c++){var f=b.records[c];f.children=[],f.pid=f.pid||0,f.abr=f.abr||f.nam.charAt(0),f.mid=parseInt((f.eag+f.lag)/2),f.total=f.eag-f.lag,interval_hash[f.oid]=f,interval_hash[f.pid].children.push(f)}var j=d3.layout.partition().sort(function(a){d3.ascending(a)}).value(function(a){return a.total}),k=clickcancel(),l=h.append("g").attr("id","rectGroup");l.selectAll("rect").data(j.nodes(data)).enter().append("svg:rect").attr("x",function(a){return d(a.x)}).attr("y",function(a){return e(a.y)}).attr("width",function(a){return d(a.dx)}).attr("height",function(a){return e(a.dy)}).attr("fill",function(a){return a.col||"#000000"}).attr("id",function(a){return"t"+a.oid}).style("opacity",.83).call(g).call(k).dblTap(function(a){setTimeout(timeScale.goTo(a),500)}).append("svg:title").text(function(a){return a.nam}),k.on("dblclick",function(a){timeScale.goTo(a.target.__data__)}),k.on("click",function(a){timeScale.mapFilter(a.target.__data__)});var m=i.selectAll("rect").data(j.nodes(data)),n=m.enter().append("g").attr("class",function(a){return"tickGroup s"+("undefined"==typeof a.lvl?0:a.lvl)}).attr("transform",function(a){return"translate("+d(a.x)+", 0)"});n.append("line").attr("x1",0).attr("y1",7.5).attr("x2",0).attr("y2",12).style("stroke-width","0.05em"),n.append("text").attr("x",0).attr("y",20).style("text-anchor",function(a){return.0117==a.eag?"end":"middle"}).style("font-size","0.85em").style("fill","#777").text(function(a){return a.eag});var o=i.append("g").data([{x:1,y:0}]).attr("class","tickGroup s1 s2 s3 s4 s5").attr("transform","translate(955, 0)");o.append("line").attr("x1",0).attr("y1",7.5).attr("x2",0).attr("y2",12).style("stroke-width","0.05em"),o.append("text").attr("x",0).attr("y",20).attr("id","now").style("text-anchor","end").style("font-size","0.85em").style("fill","#777").text("0");var p=h.append("g").attr("id","textGroup"),q=clickcancel();p.selectAll("fullName").data(j.nodes(data)).enter().append("svg:text").text(function(a){return a.nam}).attr("x",1).attr("y",function(a){return e(a.y)+15}).attr("width",function(){return this.getComputedTextLength()}).attr("height",function(a){return e(a.dy)}).attr("class",function(a){return"fullName level"+("undefined"==typeof a.lvl?0:a.lvl)}).attr("id",function(a){return"l"+a.oid}).attr("x",function(a){return timeScale.labelX(a)}).call(g).call(q).dblTap(function(a){setTimeout(timeScale.goTo(a),500)}).append("svg:title").text(function(a){return a.nam}),q.on("dblclick",function(a){timeScale.goTo(a.target.__data__)}),q.on("click",function(a){timeScale.mapFilter(a.target.__data__)});var r=clickcancel();p.selectAll("abbrevs").data(j.nodes(data)).enter().append("svg:text").attr("x",1).attr("y",function(a){return e(a.y)+15}).attr("width",30).attr("height",function(a){return e(a.dy)}).text(function(a){return a.abr||a.nam.charAt(0)}).attr("class",function(a){return"abbr level"+("undefined"==typeof a.lvl?0:a.lvl)}).attr("id",function(a){return"a"+a.oid}).attr("x",function(a){return timeScale.labelAbbrX(a)}).call(r).dblTap(function(a){setTimeout(timeScale.goTo(a),500)}).append("svg:title").text(function(a){return a.nam}),r.on("dblclick",function(a){timeScale.goTo(a.target.__data__)}),r.on("click",function(a){timeScale.mapFilter(a.target.__data__)}),timeScale.goTo(interval_hash[0]),d3.select(".abbr.levelundefined").remove(),timeScale.goTo(interval_hash[751])}),timeScale.resize()},labelLevels:function(d){if(d3.select("#l"+d.oid).attr("x",430),"undefined"!=typeof d.parent){for(var depth=d.depth,loc="d.parent",i=0;depth>i;i++){var parent=eval(loc).nam;d3.selectAll(".abbr").filter(function(a){return a.nam===parent}).attr("x",430),d3.selectAll(".fullName").filter(function(a){return a.nam===parent}).attr("x",430),loc+=".parent"}d3.selectAll(".abbr").filter(function(a){return a.nam===parent}).attr("x",430),d3.selectAll(".fullName").filter(function(a){return a.nam===parent}).attr("x",430)}},labelAbbrX:function(a){var b,c=parseFloat(d3.select("#t"+a.oid).attr("width")),d=parseFloat(d3.select("#t"+a.oid).attr("x"));try{b=d3.select("#a"+a.oid).node().getComputedTextLength()}catch(e){b=11}return b>c-8&&d3.select("#a"+a.oid).style("display","none"),d+(c-b)/2},labelX:function(a){var b,c=parseFloat(d3.select("#t"+a.oid).attr("width")),d=parseFloat(d3.select("#t"+a.oid).attr("x"));try{b=d3.select("#l"+a.oid).node().getComputedTextLength()}catch(e){b=25}return b>c-8?d3.select("#l"+a.oid).style("display","none"):d3.select("#a"+a.oid).style("display","none"),d+(c-b)/2},labelY:function(a){{var b=parseFloat(d3.select("#t"+a.oid).attr("height")),c=parseFloat(d3.select("#t"+a.oid).attr("y")),d=d3.select("#l"+a.oid).node().getBBox().height;parseInt(d3.select(".timeScale").style("width"))/961}return.8*c+(b-d)/2+8},labelAbbrY:function(a){{var b=parseFloat(d3.select("#t"+a.oid).attr("height")),c=parseFloat(d3.select("#t"+a.oid).attr("y")),d=d3.select("#l"+a.oid).node().getBBox().height;parseInt(d3.select(".timeScale").style("width"))/961}return.8*c+(b-d)/2},mapFilter:function(a){var b=document.getElementById("reconstructBox").checked;if(a.oid!==navMap.filters.selectedInterval.oid)if(timeScale.highlight(a.nam),navMap.filters.selectedInterval.nam=a.nam,navMap.filters.selectedInterval.mid=a.mid,navMap.filters.selectedInterval.col=a.col,navMap.filters.selectedInterval.oid=a.oid,navMap.filters.exist.selectedInterval=!0,navMap.updateFilterList("selectedInterval"),b){var c=parseInt((a.eag+a.lag)/2);if(a.depth<3)return alert("Please select a period or finer interval");if(c>550)return alert("Please select an interval younger than 600 MA");navMap.refresh("reset"),reconstructMap.rotate(a)}else navMap.refresh("reset")},goTo:function(a){if("string"==typeof a){var a=d3.selectAll("rect").filter(function(b){return b.nam===a});a=a[0][0].__data__}else if(a.children){if(a.children.length<1)var a=a.parent}else var a=a;timeScale.currentInterval=a;var b="undefined"!=a.depth?parseInt(a.depth)+1:1;d3.selectAll(".scale").style("display","none"),d3.selectAll(".tickGroup").style("display","none"),d3.selectAll(".s"+b).style("display","block"),d3.select(".timeScale g").attr("transform",function(){return"scale("+parseInt(d3.select(".timeScale").style("width"))/961+")"});var c=0,d=d3.scale.linear().range([5,955]);d.domain([a.x,a.x+a.dx]),d3.selectAll(".fullName").style("fill","rgba(0,0,0,0)").style("display","block"),d3.selectAll(".abbr").style("fill","rgba(0,0,0,0)").style("display","block"),d3.selectAll(".tickGroup").transition().duration(750).attr("transform",function(a){return d3.select(this).selectAll("text").style("text-anchor","middle"),5==d(a.x)?d3.select(this).select("text").style("text-anchor","start"):955==d(a.x)&&d3.select(this).select("text").style("text-anchor","end"),"translate("+d(a.x)+", 0)"}),d3.selectAll("rect").transition().duration(750).each(function(){++c}).attr("x",function(a){return d(a.x)}).attr("width",function(a){return d(a.x+a.dx)-d(a.x)}).each("end",function(){--c||timeScale.labelTrans(a)})},labelTrans:function(a){var b=0,c=d3.scale.linear().range([0,955]),d=d3.scale.linear().range([0,120]);c.domain([a.x,a.x+a.dx]),d3.selectAll(".fullName").transition().duration(10).each(function(){++b}).attr("x",function(a){return timeScale.labelX(a)}).attr("height",function(a){return d(a.y+a.dy)-d(a.y)}).each("end",function(){--b||timeScale.labelLevels(a)}),d3.selectAll(".abbr").transition().duration(300).each(function(){++b}).attr("x",function(a){return timeScale.labelAbbrX(a)}).attr("height",function(a){return d(a.y+a.dy)-d(a.y)}).each("end",function(){--b?(d3.selectAll(".fullName").style("fill","#333"),d3.selectAll(".abbr").style("fill","#333")):(timeScale.labelLevels(a),d3.select("#l0").style("fill","#fff"))}),timeScale.resize()
},highlight:function(a){if(timeScale.unhighlight(),a.cxi){var b=a.cxi;d3.selectAll("rect#t"+a.cxi).style("stroke","#000").moveToFront(),d3.selectAll("#l"+a.cxi).moveToFront()}else if("string"==typeof a){var b=d3.selectAll("rect").filter(function(b){return b.nam===a}).attr("id");b=b.replace("t","")}else{var b=d3.select(a).attr("id");b=b.replace("p","")}d3.selectAll("rect#t"+b).style("stroke","#000").moveToFront(),d3.selectAll("#l"+b).moveToFront(),d3.selectAll(".abbr").moveToFront()},unhighlight:function(){d3.selectAll("rect").style("stroke","#fff")},resize:function(){d3.select(".timeScale g").attr("transform",function(){var a=parseInt(d3.select("#graphics").style("width"));return"scale("+a/961+")"});var a,b=d3.select(".timeScale").select("svg");try{a=b.node().getBBox()}catch(c){a={x:b.node().clientLeft,y:b.node().clientTop,width:b.node().clientWidth,height:b.node().clientHeight}}d3.select(".timeScale svg").style("width",function(){return parseInt(d3.select("#graphics").style("width"))-1+"px"}),d3.select(".timeScale svg").style("height",function(){return a.height+5+"px"})},interval_hash:interval_hash,currentInterval:currentInterval}}(),reconstructMap=function(){var a,b=!1,c={nam:"",taxon:"",person:""},d=500,e=960,f=d3.geo.hammer().scale(165).translate([e/2,d/2]).rotate([1e-6,0]).precision(.3),g=d3.geo.path().projection(f);return{init:function(){var a=d3.select("#reconstructMap").append("svg").attr("height",d).attr("width",e).append("g").attr("id","reconstructGroup");a.append("defs").append("path").datum({type:"Sphere"}).attr("id","sphere").attr("d",g),a.append("use").attr("class","stroke").attr("xlink:href","#sphere"),a.append("use").attr("class","fill").attr("xlink:href","#sphere"),$("#mapSwitch").on("click",function(a){a.preventDefault(),paleo_nav.closeReconstructMap()})},rotate:function(d){if(d.nam==c.nam&&navMap.filters.taxon.name==c.taxon&&navMap.filters.personFilter.name==c.person)return d3.select("#selectedInterval").select("button").style("display","none"),void 0;navMap.filterByTime(d.nam),b=!0,reconstructMap.reset(),paleo_nav.showLoading(),d3.select("#interval").text(d.nam),d3.select("#rotationInterval").html(d.nam),d3.select("#age").text("("+d.mid+" Ma)"),d3.select("#rotationYear").html(d.mid+" Ma"),d.mid<201?d3.select("#rotationReference").html("<p>Seton, M., R.D. Müller, S. Zahirovic, C. Gaina, T.H. Torsvik, G. Shephard, A. Talsma, M. Gurnis, M. Turner, S. Maus, M. Chandler. 2012. Global continental and ocean basin reconstructions since 200 Ma. <i>Earth-Science Reviews </i>113:212-270.</p>"):d3.select("#rotationReference").html("<p>Wright, N. S. Zahirovic, R.D. Müller, M. Seton. 2013. Towards community-driven paleogeographic reconstructions: intergrating open-access paleogeographic and paleobiology data with plate tectonics. <i>Biogeosciences </i>10:1529-1541.</p>"),d3.select("#selectedInterval").select("button").style("display","none");var e=d3.select("#reconstructGroup").append("g").attr("id","reconstructContent"),f=d.nam.split(" ").join("_");d3.json("build/js/collections/"+f+".json",function(b,c){d3.json("build/js/plates/"+f+".json",function(b,h){e.selectAll(".plateLines").data(topojson.feature(h,h.objects[f]).features).enter().append("path").attr("class","plates").attr("d",g),timeScale.highlight(d.nam),parseInt(d3.select("#map").style("height"))>1&&d3.select("#map").style("display","none"),d3.select("#svgMap").style("display","none"),d3.select("#reconstructMap").style("display","block"),reconstructMap.resize(),d3.select(".info").html("").style("display","none"),d3.json("build/js/rotatedIntervals/"+f+".json",function(b,e){var f=Object.keys(e.objects),g=f[0];if(a=topojson.feature(e,e.objects[g]),navMap.filters.exist.taxon||navMap.filters.exist.personFilter){var h=paleo_nav.baseUrl+"/data1.1/colls/summary.json?lngmin=-180&lngmax=180&latmin=-90&latmax=90&level=3&limit=99999";h=navMap.parseURL(h),d3.json(h,function(b,e){var f=e.records,g=[];f.forEach(function(b){a.features.forEach(function(a){b.oid===parseInt(a.properties.NAME)&&g.push(a)})}),g.forEach(function(a){for(var b=0;b<c.records.length;b++)parseInt(a.properties.NAME)==c.records[b].oid&&(a.properties.nco=c.records[b].nco,a.properties.noc=c.records[b].noc,a.properties.oid=c.records[b].oid)}),reconstructMap.addToMap(g,d)})}else a.features.forEach(function(a){for(var b=0;b<c.records.length;b++)parseInt(a.properties.NAME)==c.records[b].oid&&(a.properties.nco=c.records[b].nco,a.properties.noc=c.records[b].noc,a.properties.oid=c.records[b].oid)}),reconstructMap.addToMap(a.features,d)})})})},addToMap:function(a,c){var d=d3.select("#reconstructContent"),e=d3.scale.linear().domain([1,4240]).range([4,15]);d.selectAll("circle").data(a).enter().append("circle").attr("class","collection").style("fill",c.col).attr("r",function(a){return.7*e(a.properties.nco)}).attr("cx",function(a){var b=f(a.geometry.coordinates);return b[0]}).attr("cy",function(a){var b=f(a.geometry.coordinates);return b[1]}).on("mouseover",function(a){d3.select(".info").html("Bin ID: "+a.properties.oid+"<br>Number of collections: "+a.properties.nco+"<br>Number of occurrences: "+a.properties.noc).style("display","block")}).on("click",function(a){d3.select(".info").html("Bin ID: "+a.properties.oid+"<br>Number of collections: "+a.properties.nco+"<br>Number of occurrences: "+a.properties.noc).style("display","block"),navMap.openBinModal(a)}).on("mouseout",function(){d3.select(".info").html("").style("display","none")}),b=!1,paleo_nav.hideLoading(),reconstructMap.currentReconstruction={nam:c.nam,col:c.col,mid:c.mid,oid:c.oid,taxon:"",person:""},navMap.filters.exist.taxon&&(reconstructMap.currentReconstruction.taxon=navMap.filters.taxon.name),navMap.filters.exist.personFilter&&(reconstructMap.currentReconstruction.person=navMap.filters.personFilter.name)},addBBox:function(a){d3.selectAll(".rotatedBBox").remove();{var b=map.getBounds(),c=b._southWest,d=b.getSouthEast(),e=b._northEast,f=b.getNorthWest();map.getZoom()}c.lng=c.lng<-180?-180:c.lng,c.lat=c.lat<-90?-90:c.lat,e.lng=e.lng>180?180:e.lng,e.lat=e.lat>90?90:e.lat;var h=[{oid:"a",lat:c.lat,lng:c.lng},{oid:"b",lat:f.lat,lng:f.lng},{oid:"c",lat:e.lat,lng:e.lng},{oid:"d",lat:d.lat,lng:d.lng}];h=navMap.buildWKT(h);var i="&time="+a+'&points="'+encodeURI(h)+'"&output=geojson';d3.xhr("http://gplates.gps.caltech.edu:8080/recon_points/").header("Content-type","application/x-www-form-urlencoded").post(i,function(a,b){function c(a,b){return a.properties.NAME<b.properties.NAME?-1:a.properties.NAME>b.properties.NAME?1:0}if(a)return console.log("Gplates error - ",a),alert("GPlates could not complete the request");var d=JSON.parse(b.response),e=d;e.features.sort(c);var f={type:"FeatureCollection",features:[{geometry:{type:"Polygon",coordinates:[[e.features[0].geometry.coordinates,e.features[1].geometry.coordinates,e.features[2].geometry.coordinates,e.features[3].geometry.coordinates,e.features[3].geometry.coordinates]]},type:"Feature",properties:{}}]},h=d3.select("#reconstructContent");h.selectAll(".bbox").data(f.features).enter().append("path").attr("class","rotatedBBox").attr("fill","none").attr("stroke","#ccc").attr("stroke-dasharray","5,5").attr("stroke-width",2).attr("opacity",1).attr("d",g)})},resize:function(){var a=parseInt(d3.select("#graphics").style("width")),b=d3.select("#reconstructMap").select("svg");d3.select("#reconstructGroup").attr("transform",function(){var c;try{c=b.node().getBBox()}catch(d){c={x:b.node().clientLeft,y:b.node().clientTop,width:b.node().clientWidth,height:b.node().clientHeight}}if(a>c.width+50)return"scale("+window.innerHeight/800+")translate("+(a-c.width)/2+",0)";var e=.7*window.innerHeight-70,f=a/970*500;return"scale("+a/970+")translate(0,"+(e-f)/2+")"}),d3.select("#reconstructMap").select("svg").style("height",function(){return.7*window.innerHeight-70+"px"}).style("width",function(){return a-15+"px"}),d3.select("#reconstructMapRefContainer").style("height",function(){return d3.select("#svgMap").style("height")})},reset:function(){d3.select("#reconstructContent").remove(),d3.select("#interval").html(""),d3.select("#age").html("")},currentReconstruction:c,reconstructing:b}}(),taxaBrowser=function(){return{init:function(){$("#taxaSearch").submit(function(){return taxaBrowser.goToTaxon(),!1})},goToTaxon:function(a){if(!a)var a=$("#taxonInput").val();a.length>0&&d3.json(paleo_nav.baseUrl+"/data1.1/taxa/list.json?name="+a,function(a,b){if(a)alert("Error retrieving from list.json - ",a);else{if(!(b.records.length>0))return alert("No taxa with this name found");var c={id:b.records[0].oid,name:b.records[0].nam};navMap.filters.taxa.push(c),navMap.filters.exist.taxon=!0,navMap.updateFilterList("taxon",b.records[0].oid),paleo_nav.untoggleTaxa(),d3.select(".taxonTitle").html(b.records[0].nam+" ("+taxaBrowser.rankMap(b.records[0].rnk)+")").attr("id",function(){return b.records[0].nam}),taxaBrowser.getTaxonDetails(b.records[0]),$("#taxonInput").val(""),$("#taxaInput").val(""),"block"==d3.select("#reconstructMap").style("display")?reconstructMap.rotate(navMap.filters.selectedInterval):navMap.refresh("reset")}})},getTaxonDetails:function(a){d3.json(paleo_nav.baseUrl+"/data1.1/taxa/single.json?id="+a.oid+"&show=attr,nav,size",function(a,b){if(a)alert("Error retrieving from single.json - ",a);else{if(!(b.records.length>0))return alert("No taxon details found - browser");d3.select(".taxonAttr").html(b.records[0].att),taxaBrowser.computeParentList(b.records[0]),taxaBrowser.computeChildList(b.records[0])}})},computeParentList:function(a){var b=[],c=0;a.kgt&&a.kgn&&a.kgn!=a.gid&&(a.kgt.rnk="kingdom*",b.push(a.kgt),c=a.kgn),a.phl&&a.phn&&a.phn!=a.gid&&(a.pht.rnk="phylum*",b.push(a.pht),c=a.phn),a.cll&&a.cln&&a.cln!=a.gid&&(a.clt.rnk="class*",b.push(a.clt),c=a.cln),a.odl&&a.odn&&a.odn!=a.gid&&(a.odt.rnk="order*",b.push(a.odt),c=a.odn),a.fml&&a.fmn&&a.fmn!=a.gid&&(a.fmt.rnk="family*",b.push(a.fmt),c=a.fmn),a.prt&&a.par!=c&&b.push(a.prt);var d=d3.select("#focalTaxonParents");d.selectAll("tr").remove(),d.selectAll(".rows").data(b).enter().append("tr").append("td").append("a").attr("id",function(a){return a.nam}).attr("href","#").html(function(a){return a.nam+" ("+a.rnk+")"}).attr("class",function(a,c){return c==b.length-1?0==a.ext?"immediateParent extinct parents":"immediateParent parents":0==a.ext?"extinct parents":"parents"}),taxaBrowser.reattachHandlers(a)},computeChildList:function(a){var b=[];a.chl&&a.rnk>5&&(0==a.chl.length||!a.gns||a.chl.length!=a.gnc)&&b.push({section:"immediate subtaxa",size:a.chl.length,offset:0,order:"size.desc",taxa:a.chl}),a.phs&&b.push({section:"phyla",size:a.phc,rank:20,offset:0,max:10,order:"size.desc",taxa:a.phs}),a.cls&&b.push({section:"classes",size:a.clc,rank:17,offset:0,max:10,order:"size.desc",taxa:a.cls}),a.ods&&b.push({section:"orders",size:a.odc,rank:13,offset:0,max:10,order:"size.desc",taxa:a.ods}),a.fms&&b.push({section:"families",size:a.fmc,rank:9,offset:0,max:10,order:"size.desc",taxa:a.fms}),a.gns&&b.push({section:"genera",size:a.gnc,rank:5,offset:0,max:10,order:"size.desc",taxa:a.gns}),a.sgs&&a.sgs.length>0&&b.push({section:"subgenera",size:a.gnc,rank:4,offset:0,max:10,order:"size.desc",taxa:a.sgs}),a.sps&&a.sps.length>0&&b.push({section:"species",size:a.sps.length,rank:3,offset:0,max:10,order:"size.desc",taxa:a.sps}),a.sss&&a.sss.length>0&&b.push({section:"subspecies",size:a.sss.length,rank:2,offset:0,max:10,order:"size.desc",taxa:a.sss});var c=d3.select("#focal_taxon_children");c.selectAll("tr").remove(),c.selectAll(".rows").data(b).enter().append("tr").append("td").append("a").attr("id",function(a){return"t"+a.rank}).attr("class","children").attr("href","#").html(function(a){return a.size+" "+a.section}),taxaBrowser.reattachHandlers(a)},getSubtaxa:function(a,b,c,d){var e="";if("number"==typeof c&&(e+="&offset="+c),"number"==typeof d&&(e+="&limit="+d),b>0){var f=paleo_nav.baseUrl+"/data1.1/taxa/list.json?id="+a.oid+e+"&show=size&rel=all_children&rank="+b;d3.json(f,function(b,c){function d(a,b){return a.siz>b.siz?-1:a.siz<b.siz?1:0}c.records.length>0&&(d3.select("#subtaxa").selectAll("li").remove(),d3.select("#subtaxa").selectAll("br").remove(),c.records.sort(d),c.records.forEach(function(a){var b=0===a.ext?"extinct childTaxa":"childTaxa";$("#subtaxa").append("<li><a href='#' class='"+b+"' id='"+a.nam+"'>"+a.nam+" ("+a.siz+") </a></li>")}),$("#subtaxa").append("<br>"),taxaBrowser.reattachHandlers(a),$("#subtaxaModal").modal())})}},rankMap:function(a){var b={25:"unranked",23:"kingdom",22:"subkingdom",21:"superphylum",20:"phylum",19:"subphylum",18:"superclass",17:"class",16:"subclass",15:"infraclass",14:"superorder",13:"order",12:"suborder",11:"infraorder",10:"superfamily",9:"family",8:"subfamily",7:"tribe",6:"subtribe",5:"genus",4:"subgenus",3:"species",2:"subspecies"};return b[a]},reattachHandlers:function(a){$(".parents").click(function(a){a.preventDefault(),taxaBrowser.goToTaxon(a.target.id),navMap.filterByTaxon(a.target.id)}),$(".childTaxa").click(function(a){a.preventDefault(),$("#subtaxaModal").modal("hide"),$("#taxaFilterInput").val(""),taxaBrowser.goToTaxon(a.target.id),navMap.filterByTaxon(a.target.id)}),$(".children").click(function(b){b.preventDefault(),taxaBrowser.getSubtaxa(a,b.target.id.substr(1))}),$(".taxonTitle").click(function(a){a.preventDefault(),taxaBrowser.goToTaxon(a.target.id)})},filter:function(a){var b=$(a).val();b=b.charAt(0).toUpperCase()+b.slice(1),$("#subtaxa > li:not(:contains("+b+"))").hide(),$("#subtaxa > li:contains("+b+")").show()}}}(),map,navMap=function(){var a,b,c,d={lng:0,lat:0},e={lng:0,lat:0},f=3,g={selectedInterval:{nam:"",mid:"",oid:""},personFilter:{id:"",name:""},taxa:[],exist:{selectedInterval:!1,personFilter:!1,taxon:!1}},h=960,i=500,j=d3.geo.hammer().scale(165).translate([h/2,i/2]).rotate([1e-6,0]).precision(.1),k=d3.geo.path().projection(j);return{init:function(){map=new L.Map("map",{center:new L.LatLng(7,0),zoom:2,maxZoom:10,minZoom:2,zoomControl:!1,inertiaDeceleration:6e3,inertiaMaxSpeed:1e3,zoomAnimationThreshold:1});var c='Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';a=new L.TileLayer("http://{s}.tile.stamen.com/toner-background/{z}/{x}/{y}.png",{attribution:c}).addTo(map),b=new L.TileLayer("http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png",{attribution:c}),map.on("moveend",function(a){a.hard||parseInt(d3.select("#map").style("height"))<2||(d3.select(".info").style("display","none"),map.getZoom()<3&&(d3.select("#map").style("height",0),d3.select("#svgMap").style("display","block"),setTimeout(navMap.resizeSvgMap,300)),navMap.refresh())}),map.on("zoomend",function(){d3.select(".leaflet-zoom-hide").style("visibility","hidden"),navMap.selectBaseMap(map.getZoom())}),map._initPathRoot(),d3.select("#map").select("svg").append("g").attr("class","leaflet-zoom-hide").attr("id","binHolder"),d3.select("#map").style("height",0);var d=d3.behavior.zoom().on("zoom",function(){d3.event.sourceEvent.wheelDelta>0?navMap.changeMaps(d3.mouse(this)):"touchmove"==d3.event.sourceEvent.type&&navMap.changeMaps([d3.event.sourceEvent.pageX,d3.event.sourceEvent.pageY])}),e=d3.select("#svgMap").append("svg").attr("width",h).attr("height",i).call(d).on("click",function(){navMap.changeMaps(d3.mouse(this))}).append("g");e.append("defs").append("path").datum({type:"Sphere"}).attr("id","sphere").attr("d",k),e.append("use").attr("class","fill").attr("xlink:href","#sphere"),d3.json("build/js/countries_1e5.json",function(a,b){e.append("path").datum(topojson.feature(b,b.objects.countries)).attr("class","countries").attr("d",k),reconstructMap.resize(),timeScale.resize(),navMap.refresh("reset"),navMap.resizeSvgMap(),setTimeout(navMap.resize,100),setTimeout(navMap.resize,100),navMap.resizeSvgMap()})},changeMaps:function(a){var b=d3.geo.mercator().scale(165).precision(.1).translate([h/2,i/2]),c=a,d=b.invert(c);d3.select("#svgMap").style("display","none"),d3.select("#map").style("height",function(){if(window.innerHeight>window.innerWidth){var a=$("#time").height();return window.innerHeight-a-70+"px"}return.7*window.innerHeight-70+"px"}),map.setView([parseInt(d[1]),parseInt(d[0])],3,{animate:!1}),navMap.refresh("reset"),map.invalidateSize()},goTo:function(a,b){3>b||(d3.select("#svgMap").style("display","none"),d3.select("#map").style("height",function(){return.7*window.innerHeight+"px"}),map._resetView(a,b))},selectBaseMap:function(c){5>c?map.hasLayer(b)&&(map.removeLayer(b),map.addLayer(a)):c>4&&8>c?map.hasLayer(b)&&(map.removeLayer(b),map.addLayer(a)):map.hasLayer(b)?map.removeLayer(a):(map.addLayer(b),map.removeLayer(a))},refresh:function(a){paleo_nav.showLoading(),f-map.getZoom()!=0&&d3.select(".leaflet-zoom-hide").style("visibility","hidden");var b=navMap.checkFilters();if(parseInt(d3.select("#map").style("height"))<1){"undefined"!=typeof c&&Object.keys(c).length>0&&(c.abort(),c={});var h=paleo_nav.baseUrl+"/data1.1/colls/summary.json?lngmin=-180&lngmax=180&latmin=-90&latmax=90&limit=999999&show=time";if(b){if(1!=g.exist.selectedInterval||g.exist.personFilter||g.exist.taxon)h+="&level=2",h=navMap.parseURL(h);else if(h+="&level=3",h=navMap.parseURL(h),"undefined"!=typeof timeScale.interval_hash[g.selectedInterval.oid]){if("undefined"!=typeof timeScale.interval_hash[g.selectedInterval.oid].data)return navMap.refreshHammer(timeScale.interval_hash[g.selectedInterval.oid].data);c=d3.json(h,function(a,b){return timeScale.interval_hash[g.selectedInterval.oid].data=b,navMap.refreshHammer(b)})}}else h+="&level=1",h=navMap.parseURL(h);return c=d3.json(h,function(a,b){navMap.refreshHammer(b)}),void 0}var i=map.getBounds(),j=i._southWest,k=i._northEast,l=map.getZoom();if(!a)if(e.lat>k.lat&&e.lng>k.lng&&d.lat<j.lat&&d.lng<j.lng){if(3>f&&l>2);else if(5>f&&l>4);else if(!(7>f&&l>6)){if(f===l)return f=l,paleo_nav.hideLoading(),void 0;var m=d3.selectAll(".bins");if(l>6){var n=d3.selectAll(".clusters");return f=l,navMap.redrawPoints(m,n)}return f=l,navMap.redrawPoints(m)}}else if(f>2&&7>l&&b&&1==g.exist.selectedInterval&&!g.exist.personFilter&&!g.exist.taxon)if(d3.select("#binHolder").selectAll("circle")[0].length<1);else if(!(7>f&&l>6||f>6&&7>l)){var m=d3.selectAll(".bins");if(l>6){var n=d3.selectAll(".clusters");return f=l,navMap.redrawPoints(m,n)}return f=l,navMap.redrawPoints(m)}if(d=j,e=k,f=l,j.lat=j.lat<-90?-90:j.lat,k.lat=k.lat>90?90:k.lat,"undefined"!=typeof c&&Object.keys(c).length>0&&(c.abort(),c={}),5>l&&0==b){var h=paleo_nav.baseUrl+"/data1.1/colls/summary.json?lngmin="+j.lng+"&lngmax="+k.lng+"&latmin="+j.lat+"&latmax="+k.lat+"&level=2&limit=999999&show=time";c=d3.json(navMap.parseURL(h),function(a,b){navMap.drawBins(b,1,l)})}else if(l>4&&7>l||5>l&&1==b)if(1!=g.exist.selectedInterval||g.exist.personFilter||g.exist.taxon){var h=paleo_nav.baseUrl+"/data1.1/colls/summary.json?lngmin="+j.lng+"&lngmax="+k.lng+"&latmin="+j.lat+"&latmax="+k.lat+"&level=3&limit=99999&show=time";c=d3.json(navMap.parseURL(h),function(a,b){navMap.drawBins(b,2,l)})}else{var h=paleo_nav.baseUrl+"/data1.1/colls/summary.json?lngmin=-180&lngmax=180&latmin=-90&latmax=90&limit=999999&show=time&level=3";if(h=navMap.parseURL(h),"undefined"!=typeof timeScale.interval_hash[g.selectedInterval.oid]){if("undefined"!=typeof timeScale.interval_hash[g.selectedInterval.oid].data)return navMap.drawBins(timeScale.interval_hash[g.selectedInterval.oid].data,2,l);c=d3.json(h,function(a,b){return timeScale.interval_hash[g.selectedInterval.oid].data=b,navMap.drawBins(b,2,l)})}}else{var h=paleo_nav.baseUrl+"/data1.1/colls/list.json?lngmin="+j.lng+"&lngmax="+k.lng+"&latmin="+j.lat+"&latmax="+k.lat+"&limit=99999999&show=time";c=d3.json(navMap.parseURL(h),function(a,b){navMap.drawCollections(b,3,l)})}},redrawPoints:function(a,b){d3.select(".leaflet-zoom-hide").style("visibility","hidden");var c=map.getZoom();if(5>c)if(navMap.checkFilters())var d=d3.scale.log().domain([1,400]).range([4,30]);else var d=d3.scale.linear().domain([1,3140]).range([4,30]);else if(c>4&&7>c)var d=d3.scale.log().domain([1,400]).range([4,30]);else var d=d3.scale.linear().domain([1,50]).range([12,30]);a.attr("cx",function(a){return map.latLngToLayerPoint([a.lat,a.lng]).x}),a.attr("cy",function(a){return map.latLngToLayerPoint([a.lat,a.lng]).y}),b?(b.attr("cx",function(a){return map.latLngToLayerPoint([a.lat,a.lng]).x}),b.attr("cy",function(a){return map.latLngToLayerPoint([a.lat,a.lng]).y}),b.attr("r",function(a){return d(a.members.length)}),a.attr("r",12)):d3.select("#binHolder").selectAll(".bins")[0].length<30?a.attr("r",8):a.attr("r",function(a){return d(a.nco)*navMap.multiplier(c)<4?4:d(a.nco)*navMap.multiplier(c)}),paleo_nav.hideLoading(),d3.select(".leaflet-zoom-hide").style("visibility","visible")},refreshHammer:function(a){var b=d3.scale.linear().domain([1,4240]).range([4,15]),c=d3.select("#svgMap").select("svg").select("g"),d=2,e=c.selectAll("circle").data(a.records);e.enter().append("circle").attr("id",function(a){return"p"+a.cxi}).attr("class","bins").on("mouseout",function(){d3.select(".info").html("").style("display","none"),timeScale.unhighlight()}),e.style("fill",function(a){return timeScale.interval_hash[a.cxi]?timeScale.interval_hash[a.cxi].col:"#000"}).attr("id",function(a){return"p"+a.cxi}).attr("r",function(a){return b(a.nco)*navMap.multiplier(d)}).attr("cx",function(a){var b=j([a.lng,a.lat]);return b[0]}).attr("cy",function(a){var b=j([a.lng,a.lat]);return b[1]}).on("mouseover",function(a){d3.select(".info").html("Number of collections: "+a.nco+"<br>Number of occurrences: "+a.noc).style("display","block"),timeScale.highlight(this)}).on("click",function(){d3.event.stopPropagation()}),e.exit().remove(),reconstructMap.reconstructing||paleo_nav.hideLoading()},drawBins:function(a,b){d3.selectAll(".clusters").remove();var c=d3.select("#binHolder"),d=c.selectAll(".bins").data(a.records);d.attr("id",function(a){return"p"+a.cxi}).style("fill",function(a){return timeScale.interval_hash[a.cxi]?timeScale.interval_hash[a.cxi].col:"#000"}).on("mouseover",function(a){d3.select(".info").html("Number of collections: "+a.nco+"<br>Number of occurrences: "+a.noc).style("display","block"),timeScale.highlight(this)}).on("click",function(a){2===b&&(d3.select(".info").html("Number of collections: "+a.nco+"<br>Number of occurrences: "+a.noc).style("display","block"),timeScale.highlight(this),navMap.openBinModal(a))}),d.enter().append("circle").attr("class","bins").attr("id",function(a){return"p"+a.cxi}).style("fill",function(a){return timeScale.interval_hash[a.cxi]?timeScale.interval_hash[a.cxi].col:"#000"}).on("mouseover",function(a){d3.select(".info").html("Number of collections: "+a.nco+"<br>Number of occurrences: "+a.noc).style("display","block"),timeScale.highlight(this)}).on("click",function(a){2===b&&(d3.select(".info").html("Number of collections: "+a.nco+"<br>Number of occurrences: "+a.noc).style("display","block"),timeScale.highlight(this),navMap.openBinModal(a))}).on("mouseout",function(){d3.select(".info").html("").style("display","none"),timeScale.unhighlight()}),d.exit().remove(),navMap.redrawPoints(d)},drawCollections:function(a){for(var b=d3.select("#binHolder"),c=[],d=0;d<a.records.length;d++)for(var e=0;e<a.records.length;e++)if(a.records[d].lat==a.records[e].lat&&a.records[d].lng==a.records[e].lng&&a.records[d].oid!=a.records[e].oid){for(var f={lat:a.records[d].lat,lng:a.records[d].lng,members:[]},g=0,h=0;h<c.length;h++)f.lat==c[h].lat&&f.lng==c[h].lng&&(g+=1);if(1>g){c.push(f);break}break}for(var i=[],d=0;d<c.length;d++)for(var e=0;e<a.records.length;e++)c[d].lat==a.records[e].lat&&c[d].lng==a.records[e].lng&&(c[d].members.push(a.records[e]),i.push(a.records[e].oid));for(var d=0;d<i.length;d++){var j=navMap.getIndex(a.records,i[d],"oid");a.records.splice(j,1)}c.forEach(function(a){var b=[];a.members.forEach(function(a){b.push(a.noc)}),a.cxi=a.members[0].cxi,a.noc=d3.sum(b)});var c=b.selectAll(".clusters").data(c);c.attr("id",function(a){return"p"+a.members[0].cxi}).style("fill",function(a){return timeScale.interval_hash[a.cxi].col}).on("mouseover",function(a){d3.select(".info").html("<strong>"+a.nam+"</strong><br>"+a.noc+" occurrences").style("display","block"),timeScale.highlight(this)}).on("click",function(a){d3.select(".info").html("<strong>"+a.nam+"</strong><br>"+a.noc+" occurrences").style("display","block"),timeScale.highlight(this),navMap.openStackedCollectionModal(a)}).on("mouseout",function(){timeScale.unhighlight()}),c.enter().append("circle").attr("class","clusters").attr("id",function(a){return"p"+a.members[0].cxi}).style("fill",function(a){return timeScale.interval_hash[a.members[0].cxi]?timeScale.interval_hash[a.members[0].cxi].col:"#000"}).on("mouseover",function(a){d3.select(".info").html("<strong>"+a.members.length+" collections</strong><br>"+a.noc+" occurrences").style("display","block"),timeScale.highlight(this)}).on("mouseout",function(){timeScale.unhighlight()}).on("click",function(a){d3.select(".info").html("<strong>"+a.nam+"</strong><br>"+a.noc+" occurrences").style("display","block"),timeScale.highlight(this),navMap.openStackedCollectionModal(a)}),c.exit().remove();var k=b.selectAll(".bins").data(a.records);existingPoints=k.attr("id",function(a){return"p"+a.cxi}).style("fill",function(a){return timeScale.interval_hash[a.cxi]?timeScale.interval_hash[a.cxi].col:"#000"}).on("mouseover",function(a){d3.select(".info").html("<strong>"+a.nam+"</strong><br>"+a.noc+" occurrences").style("display","block"),timeScale.highlight(this)}).on("click",function(a){d3.select(".info").html("<strong>"+a.nam+"</strong><br>"+a.noc+" occurrences").style("display","block"),timeScale.highlight(this),navMap.openCollectionModal(a)}).on("mouseout",function(){timeScale.unhighlight()}),k.enter().append("circle").attr("id",function(a){return"p"+a.cxi}).attr("class","bins").style("fill",function(a){return timeScale.interval_hash[a.cxi]?timeScale.interval_hash[a.cxi].col:"#000"}).on("mouseover",function(a){d3.select(".info").html("<strong>"+a.nam+"</strong><br>"+a.noc+" occurrences").style("display","block"),timeScale.highlight(this)}).on("click",function(a){d3.select(".info").html("<strong>"+a.nam+"</strong><br>"+a.noc+" occurrences").style("display","block"),timeScale.highlight(this),navMap.openCollectionModal(a)}).on("mouseout",function(){timeScale.unhighlight()}),k.exit().remove(),navMap.redrawPoints(k,c)},openBinModal:function(a){var b=a.properties?a.properties.oid:a.oid,c=paleo_nav.baseUrl+"/data1.1/colls/list.json?clust_id="+b;c=navMap.parseURL(c),c+="&show=ref,loc,time",d3.json(c,function(c,d){function e(a,b){return a.count>b.count?-1:a.count<b.count?1:0}var f={},g=0,h=0;d.records.forEach(function(a){a.fmm?(f[a.fmm]?(f[a.fmm].count+=1,f[a.fmm].occurrences+=a.properties?a.properties.noc:a.noc):(f[a.fmm]={},f[a.fmm].count=1,f[a.fmm].occurrences=a.properties?a.properties.noc:a.noc),g+=1,h+=a.properties?a.properties.noc:a.noc):(f.Unknown?(f.Unknown.count+=1,f.Unknown.occurrences+=a.properties?a.properties.noc:a.noc):(f.Unknown={},f.Unknown.count=1,f.Unknown.occurrences=a.properties?a.properties.noc:a.noc),g+=1,h+=a.properties?a.properties.noc:a.noc)});var i=a.cxi?timeScale.interval_hash[a.cxi].nam:"Unknown";if(Object.keys(f).length>10){var j={binID:b,formationCount:Object.keys(f).length,collections:g,occurrences:h,interval:i};d3.text("build/partials/binModal.html",function(a,b){var c=Mustache.render(b,j);d3.select(".binContent").html(c),$("#binModal").modal()})}else{var k=[];Object.keys(f).forEach(function(a){var b={name:a,count:f[a].count,occurrences:f[a].occurrences};k.push(b)}),k.sort(e);var j={binID:b,formations:k,collections:g,occurrences:h,interval:i};d3.text("build/partials/binModal.html",function(a,b){var c=Mustache.render(b,j);d3.select(".binContent").html(c),$("#binModal").modal()})}})},openCollectionModal:function(a){d3.json(paleo_nav.baseUrl+"/data1.1/colls/single.json?id="+a.oid+"&show=ref,time",function(a,b){b.records.forEach(function(a){a.intervals=a.oli?a.oei+" - "+a.oli:a.oei,a.strat=a.fmm||a.grp||a.mbb?!0:!1}),d3.text("build/partials/collectionModal.html",function(a,c){var d=Mustache.render(c,b);$("#collectionName").html(b.records[0].nam),$("#collectionModalBody").html(d),$(".general").css("display","block"),$(".nationalParks, .federalLands").css("display","none"),$("#collectionBox").modal(),$(".occurrenceTab").on("show.bs.tab",function(a){var b=a.target.id;b=b.replace("occToggle",""),d3.json(paleo_nav.baseUrl+"/data1.1/occs/list.json?coll_id="+b,function(a,c){c.records.forEach(function(a){a.rank=a.rnk?taxaBrowser.rankMap(a.rnk):"Unknown",a.itallics=a.rnk<6?"itallics":""}),d3.text("build/partials/occurrences.html",function(a,d){var e=Mustache.render(d,c);$("#occurrences"+b).html(e),$(".filterByOccurrence").click(function(a){a.preventDefault(),navMap.filterByTaxon($(this).attr("data-name"))})})})})})})},openStackedCollectionModal:function(a){a.members.forEach(function(a){a.intervals=a.oli?a.oei+" - "+a.oli:a.oei,a.strat=a.fmm||a.grp||a.mbb?!0:!1}),d3.text("build/partials/stackedCollectionModal.html",function(b,c){var d=Mustache.render(c,a);d3.select("#binID").html("Collections at ["+a.lat+", "+a.lng+"]"),d3.select("#accordion").html(d),$(".collectionCollapse").on("show.bs.collapse",function(a){var b=a.target.id;b=b.replace("collapse",""),d3.json(paleo_nav.baseUrl+"/data1.1/colls/single.json?id="+b+"&show=ref",function(a,c){$("#ref"+b).html(c.records[0].ref)})}),$(".occurrenceTab").on("show.bs.tab",function(a){var b=a.target.id;b=b.replace("occToggle",""),d3.json(paleo_nav.baseUrl+"/data1.1/occs/list.json?coll_id="+b,function(a,c){c.records.forEach(function(a){a.rank=a.rnk?taxaBrowser.rankMap(a.rnk):"Unknown"}),d3.text("build/partials/occurrences.html",function(a,d){var e=Mustache.render(d,c);$("#occurrences"+b).html(e),$(".filterByOccurrence").click(function(a){a.preventDefault(),navMap.filterByTaxon($(this).attr("data-name"))})})})}),$(".general").css("display","block"),$(".nationalParks, .federalLands").css("display","none"),$("#collectionModal").modal()})},buildWKT:function(a){for(var b="",c=0;c<a.length;c++)b+="POINT("+a[c].lat+" "+a[c].lng+" "+a[c].oid+"),";return b=b.slice(0,-1),b=encodeURI(b)},parseURL:function(a){var b=0;for(var c in g.exist)if(g.exist.hasOwnProperty(c)&&1==g.exist[c]){switch(c){case"selectedInterval":a+="&interval_id="+g.selectedInterval.oid;break;case"personFilter":a+="&person_id="+g.personFilter.id;break;case"taxon":a+="&base_id=",g.taxa.forEach(function(b){a+=b.id+","}),a=a.slice(0,-1)}b+=1}return b>0&&"none"==d3.select("#reconstructMap").style("display")&&d3.select(".filters").style("display","block"),a},checkFilters:function(){var a=0;for(var b in g.exist)g.exist.hasOwnProperty(b)&&1==g.exist[b]&&(a+=1);return a>0?(d3.select(".filters").style("display","block"),d3.select("#filterTitle").html("Filters"),!0):(d3.select(".filters").style("display","none"),d3.select("#filterTitle").html("No filters selected"),!1)},getIndex:function(a,b,c){for(var d=0,e=a.length;e>d;d++)if(a[d][c]===b)return d;return-1},multiplier:function(a){switch(a){case 2:return.7;case 3:return navMap.checkFilters()?.38:1;case 4:return navMap.checkFilters()?.48:2;case 5:return navMap.checkFilters()?.68:.6;case 6:return navMap.checkFilters()?.88:.8;case 7:return 1.5;default:return 1}},resizeSvgMap:function(){var a=parseInt(d3.select("#graphics").style("width")),b=d3.select("#svgMap").select("svg");d3.select("#svgMap").select("svg").select("g").attr("transform",function(){var c;try{c=b.node().getBBox()}catch(d){c={x:b.node().clientLeft,y:b.node().clientTop,width:b.node().clientWidth,height:b.node().clientHeight}}.7*window.innerHeight-70;if(a>c.width+50)return"scale("+window.innerHeight/800+")translate("+(a-c.width)/2+",0)";var e=.7*window.innerHeight-70,f=a/970*500;return"scale("+a/970+")translate(0,"+(e-f)/2+")"}),d3.select("#svgMap").select("svg").style("height",function(){if(window.innerHeight>window.innerWidth){var a=$("#time").height();return window.innerHeight-a-100+"px"}return.7*window.innerHeight-70+"px"}).style("width",function(){return a-15+"px"})},resize:function(){parseInt(d3.select("#map").style("height"))>1?(d3.select("#map").style("height",function(){if(window.innerHeight>window.innerWidth){var a=$("#time").height();
return window.innerHeight-a-70+"px"}return.7*window.innerHeight-70+"px"}),map.invalidateSize()):navMap.resizeSvgMap(),d3.select("#infoContainer").style("height",function(){if(window.innerHeight>window.innerWidth){var a=$("#time").height();return window.innerHeight-a-86+"px"}return.7*window.innerHeight-70+"px"}),d3.select(".filters").style("bottom",function(){var a=parseInt(d3.select("#time").select("svg").style("height"));return a+20+"px"}),d3.selectAll(".helpModalTimescaleLabel").style("top",function(){if(window.innerHeight>window.innerWidth){var a=$("#time").height();return window.innerHeight-a-105+"px"}return.7*window.innerHeight-70+"px"}),$(".universalSearchForm > div > .twitter-typeahead > .tt-dropdown-menu").width($(".universalSearchForm > div > .twitter-typeahead").width()-21)},refreshFilterHandlers:function(){d3.selectAll(".removeFilter").on("click",function(){var a=d3.select(this).node().parentNode;a=d3.select(a);var b=a.attr("id"),c=parseInt(a.attr("data-id"));switch(b){case"selectedInterval":a.style("display","none").html(""),g.exist.selectedInterval=!1,d3.select(".time").style("box-shadow",""),timeScale.unhighlight();for(var d=Object.keys(g[b]),e=0;e<d.length;e++)g[b][d[e]]="";break;case"personFilter":a.style("display","none").html(""),g.exist.personFilter=!1,d3.select(".userFilter").style("box-shadow","");for(var d=Object.keys(g[b]),e=0;e<d.length;e++)g[b][d[e]]="";break;case"taxon":a.remove();var f;g.taxa.forEach(function(a,b){parseInt(a.id)===c&&(f=b)}),g.taxa.splice(f,1),g.taxa.length<1&&(g.exist.taxon=!1),d3.select(".taxa").style("box-shadow","")}"block"==d3.select("#reconstructMap").style("display")?reconstructMap.rotate(g.selectedInterval):navMap.refresh("reset")})},updateFilterList:function(a,b){switch(a){case"selectedInterval":d3.select("#selectedInterval").style("display","block").html(g.selectedInterval.nam+'<button type="button" class="close removeFilter" aria-hidden="true">&times;</button>'),d3.select(".time").style("box-shadow","inset 3px 0 0 #ff992c"),navMap.refreshFilterHandlers();break;case"personFilter":d3.select("#personFilter").style("display","block").html(g.personFilter.name+'<button type="button" class="close removeFilter" aria-hidden="true">&times;</button>'),d3.select(".userFilter").style("box-shadow","inset 3px 0 0 #ff992c"),navMap.refreshFilterHandlers();break;case"taxon":var c;g.taxa.forEach(function(a,d){a.id===b&&(c=d)}),d3.select(".filters").append("div").attr("id","taxon").attr("class","filter").attr("data-id",b).style("display","block").html(g.taxa[c].name+'<button type="button" class="close removeFilter" aria-hidden="true">&times;</button>'),d3.select(".taxa").style("box-shadow","inset 3px 0 0 #ff992c"),navMap.refreshFilterHandlers()}d3.select(".filters").style("bottom",function(){var a=parseInt(d3.select("#time").select("svg").style("height"));return a+20+"px"})},filterByTime:function(a){var b=d3.selectAll("rect").filter(function(b){return b.nam===a});b=b[0][0].__data__,g.selectedInterval.nam=b.nam,g.selectedInterval.mid=b.mid,g.selectedInterval.col=b.col,g.selectedInterval.oid=b.oid,g.exist.selectedInterval=!0,navMap.updateFilterList("selectedInterval")},filterByTaxon:function(a){if(!a)var a=$("#taxaInput").val();taxaBrowser.goToTaxon(a)},filterByPerson:function(a){a&&(g.exist.personFilter=!0,g.personFilter.id=a.oid,g.personFilter.name=a.name?a.name:a.nam,navMap.updateFilterList("personFilter"),d3.select(".userToggler").style("display","none"),d3.select(".userFilter").style("color",""),"block"==d3.select("#reconstructMap").style("display")?reconstructMap.rotate(g.selectedInterval):navMap.refresh("reset"))},downloadView:function(){var a=map.getBounds(),b=a._southWest,c=a._northEast;parseInt(d3.select("#map").style("height"))<1&&(b.lng=-180,c.lng=180,b.lat=-90,c.lat=90);var d=paleo_nav.baseUrl+"/data1.1/colls/list.";d+=$("#tsv:checked").length>0?"txt":"csv",d+="?lngmin="+b.lng+"&lngmax="+c.lng+"&latmin="+b.lat+"&latmax="+c.lat+"&limit=99999999",d=navMap.parseURL(d),d+="&show=ref,loc,time",d=d.substring(0,d.length-1),window.open(d)},restoreState:function(a){if("object"==typeof a){var b=a;b.zoom&&b.zoom>2&&navMap.goTo(b.center,b.zoom),"Phanerozoic"!=b.timeScale&&timeScale.goTo(b.timeScale),b.taxaFilter.length>0&&b.taxaFilter.forEach(function(a){navMap.filterByTaxon(a.nam)}),"object"==typeof b.timeFilter&&navMap.filterByTime(b.timeFilter.nam),b.authFilter.id>0&&navMap.filterByPerson(b.authFilter),"block"===b.reconstruct&&(reconstructMap.rotate(b.currentReconstruction),paleo_nav.toggleReconstructMap(),navMap.checkFilters()),navMap.resize(),window.scrollTo(0,0)}},getUrl:function(){var a=map.getCenter(),b=map.getZoom(),c=d3.select("#reconstructMap").style("display"),d={timeScale:timeScale.currentInterval.nam,taxaFilter:[],timeFilter:g.selectedInterval,authFilter:g.personFilter,zoom:b,center:[a.lat,a.lng],reconstruct:c,currentReconstruction:reconstructMap.currentReconstruction};return g.taxa.length>0&&g.taxa.forEach(function(a){d.taxaFilter.push(a)}),d},filters:g}}(),paleo_nav=function(){var a="http://paleobiodb.org";return{init:function(){timeScale.init("time"),navMap.init(),reconstructMap.init(),taxaBrowser.init();var b=$(".zoom-in").hammer();b.on("tap",function(a){a.preventDefault(),parseInt(d3.select("#map").style("height"))<1?(d3.select("#svgMap").style("display","none"),d3.select("#map").style("height",function(){return.7*window.innerHeight-70+"px"}),map.setView([7,0],3,{animate:!1}),navMap.refresh("reset"),map.invalidateSize()):map.zoomIn()});var c=$(".zoom-out").hammer();c.on("tap",function(a){a.preventDefault(),map.zoomOut()});var d=$(".time").hammer();d.on("tap",function(a){a.preventDefault();var b=document.getElementById("viewByTimeBox").checked;1==b?(document.getElementById("viewByTimeBox").checked=!1,d3.select(".time").style("color","#000"),d3.select(".info").html("").style("display","none"),document.getElementById("reconstructBox").checked&&(document.getElementById("reconstructBox").checked=!1,d3.select(".rotate").style("color","#000"))):(document.getElementById("viewByTimeBox").checked=!0,d3.select(".time").style("color","#ff992c"),d3.select(".info").html("Click a time interval to filter map").style("display","block"))});var e=$(".rotate").hammer();e.on("tap",function(a){a.preventDefault();var b=document.getElementById("reconstructBox").checked;1==b?paleo_nav.closeReconstructMap():paleo_nav.toggleReconstructMap()});var f=$(".taxa").hammer();f.on("tap",function(a){a.preventDefault();var b=d3.select("#taxaBrowser").style("display");"block"==b?(paleo_nav.closeTaxaBrowser(),d3.select(".taxa").style("color","#000")):(paleo_nav.openTaxaBrowser(),d3.select(".taxa").style("color","#ff992c"))});var g=$(".taxaBrowserToggle").hammer();g.on("tap",function(a){a.preventDefault();var b=d3.select("#taxaBrowser").style("display");"block"==b?paleo_nav.closeTaxaBrowser():paleo_nav.openTaxaBrowser()});var h=Mustache.compile('<p>{{nam}}{{#msp}}<small class="misspelling">  missp.</small>{{/msp}}      <small class="taxaRank">{{rank}}</small></p>'),i=$("#taxonInput").typeahead({name:"taxaBrowser",remote:{url:a+"/data1.1/taxa/auto.json?name=%QUERY&limit=10",filter:function(a){return a.records.forEach(function(a){a.rank=taxaBrowser.rankMap(a.rnk)}),a.records}},valueKey:"nam",minLength:3,limit:10,template:h});i.on("typeahead:selected",function(a,b){navMap.filterByTaxon(b.nam)});var j=$("#universalAutocompleteInput").typeahead([{name:"time",prefetch:{url:a+"/data1.1/intervals/list.json?scale=1&order=older&max_ma=4000",filter:function(a){return a.records}},valueKey:"nam",header:'<h4 class="autocompleteTitle">Time Intervals</h4>',limt:5},{name:"contribs",prefetch:{url:a+"/data1.1/people/list.json?name=%",filter:function(a){return a.records}},valueKey:"nam",header:'<h4 class="autocompleteTitle">Authorizers</h4>',limit:5},{name:"taxa",remote:{url:a+"/data1.1/taxa/auto.json?name=%QUERY&limit=10",filter:function(a){return a.records.forEach(function(a){a.rank=taxaBrowser.rankMap(a.rnk)}),a.records}},valueKey:"nam",minLength:3,limit:10,header:'<h4 class="autocompleteTitle">Taxa</h4>',template:h}]);j.on("typeahead:selected",function(a,b,c){switch(c){case"contribs":navMap.filterByPerson(b),document.activeElement.blur();break;case"time":timeScale.goTo(b.nam),navMap.filterByTime(b.nam),navMap.refresh("reset");break;case"taxa":navMap.filterByTaxon(b.nam);break;default:console.log("default")}document.activeElement.blur(),$("#universalAutocompleteInput").blur(),$("#universalAutocompleteInput").typeahead("setQuery","")}),$("#universalAutocompleteInput").on("blur",function(){window.scrollTo(0,0)}),$("#universalSearchButton").click(function(a){a.preventDefault()}),$("input#universalAutocompleteInput").keypress(function(a){if(13==a.which){console.log($("input#universalAutocompleteInput").data().ttView);var b=$("input#universalAutocompleteInput").data().ttView.dropdownView.getFirstSuggestion();switch(b.dataset){case"contribs":navMap.filterByPerson(b.datum),document.activeElement.blur();break;case"time":timeScale.goTo(b.datum.nam),navMap.filterByTime(b.datum.nam),navMap.refresh("reset");break;case"taxa":navMap.filterByTaxon(b.datum.nam);break;default:console.log("default")}document.activeElement.blur(),$("#universalAutocompleteInput").blur(),$("#universalAutocompleteInput").typeahead("setQuery","")}}),d3.select(window).on("resize",function(){timeScale.resize(),navMap.resize(),reconstructMap.resize()}),$("#saveBox").on("show.bs.modal",function(){var b=0;for(var c in navMap.filters.exist)if(navMap.filters.exist.hasOwnProperty(c)&&1==navMap.filters.exist[c]){switch(c){case"selectedInterval":$("#filterList").append("<li>Interval - "+navMap.filters.selectedInterval.nam+"</li>");break;case"personFilter":$("#filterList").append("<li>Contributor - "+navMap.filters.personFilter.name+"</li>");break;case"taxon":$("#filterList").append("<li>Taxon - "+navMap.filters.taxon.name+"</li>")}b+=1}1>b&&$("#filterList").append("None selected");var d=map.getBounds(),e=d._southWest,f=d._northEast;parseInt(d3.select("#map").style("height"))<1&&(e.lng=-180,f.lng=180,e.lat=-90,f.lat=90);var g=a+"/data1.1/colls/list.json?lngmin="+e.lng+"&lngmax="+f.lng+"&latmin="+e.lat+"&latmax="+f.lat+"&limit=0&count";g=navMap.parseURL(g),d3.json(g,function(a,b){d3.select("#downloadCount").html(b.records_found+" collections found")})}),$("#saveBox").on("hide.bs.modal",function(){$("#filterList").html(""),$("#downloadCount").html("")}),$("#taxaForm").submit(function(){return navMap.filterByTaxon(),!1}),$(".helpModalClose").on("click",function(){$("#helpModal").modal("hide")}),$("#goToApp").on("click",function(){$("#helpModal").modal("hide")}),$("#trilobita").on("click",function(a){a.preventDefault(),paleo_nav.closeReconstructMap();var b={authFilter:{id:"",name:""},center:[30.3539163,113.24707],currentReconstruction:"",reconstruct:"none",taxaFilter:[{id:19100,nam:"Trilobita"}],timeFilter:{nam:"Cambrian",oid:22,mid:513},timeScale:"Cambrian",zoom:5};navMap.restoreState(b),$("#helpModal").modal("hide")}),$("#dinosauria").on("click",function(a){a.preventDefault(),paleo_nav.closeReconstructMap();var b={authFilter:{id:"",name:""},center:[40.5305,-109.5117],currentReconstruction:"",reconstruct:"none",taxaFilter:[{id:19968,nam:"Dinosauria"}],timeFilter:{nam:"Jurassic",oid:15,mid:173},timeScale:"Jurassic",zoom:5};navMap.restoreState(b),$("#helpModal").modal("hide")}),$("#plantae").on("click",function(a){a.preventDefault();var b={authFilter:{id:"",name:""},center:"",currentReconstruction:{nam:"Permian",col:"#F04028",mid:275,oid:17,taxon:"Plantae",person:""},reconstruct:"block",taxaFilter:[{id:151418,nam:"Plantae"}],timeFilter:{nam:"Permian",oid:17,mid:275},timeScale:"Permian",zoom:""};navMap.restoreState(b),$("#helpModal").modal("hide")}),localStorage.pbdb||window.innerWidth>700&&($("#helpModal").modal("show"),localStorage.pbdb=!0)},showLoading:function(){d3.select("#loading").style("display","block")},hideLoading:function(){d3.select("#loading").style("display","none")},untoggleTaxa:function(){d3.select(".taxaToggler").style("display","none"),d3.select(".taxa").style("color","")},untoggleUser:function(){d3.select(".userToggler").style("display","none"),d3.select(".userFilter").style("color","")},openTaxaBrowser:function(){d3.select("#graphics").attr("class","col-sm-9"),d3.select("#taxaBrowser").style("display","block"),d3.select("#taxaBrowserToggle").html('<i class="icon-double-angle-left" style="margin-right:5px;"></i>Collapse taxa browser'),d3.select(".taxaToggler").style("display","none"),timeScale.resize(),reconstructMap.resize(),navMap.resize()},closeTaxaBrowser:function(){d3.select("#graphics").attr("class","col-sm-12"),d3.select("#taxaBrowser").style("display","none"),d3.select("#taxaBrowserToggle").html('Expand taxa browser<i class="icon-double-angle-right" style="margin-left:5px;"></i>'),d3.select(".taxa").style("color","#000"),timeScale.resize(),reconstructMap.resize(),navMap.resize(),navMap.resize()},toggleReconstructMap:function(){var a=document.getElementById("viewByTimeBox").checked;if(0==a&&(document.getElementById("viewByTimeBox").checked=!0),paleo_nav.untoggleTaxa(),paleo_nav.untoggleUser(),paleo_nav.closeTaxaBrowser(),document.getElementById("reconstructBox").checked=!0,d3.select(".rotate").style("box-shadow","inset 3px 0 0 #ff992c").style("color","#ff992c"),d3.select(".info").html("Click a time interval to reconstruct collections and plates").style("display","block"),parseInt(d3.select("#map").style("height"))>1&&d3.select("#map").style("display","none"),d3.select("#svgMap").style("display","none"),d3.select("#reconstructMap").style("display","block"),reconstructMap.resize(),$(".zoom-in").hammer().off("tap").css("color","#ccc"),$(".zoom-out").hammer().off("tap").css("color","#ccc"),$(".save").on("click",function(){return!1}),$(".icon-save").css("color","#ccc"),navMap.filters.exist.selectedInterval)reconstructMap.rotate(navMap.filters.selectedInterval);else{if(interval.nam==reconstructMap.currentReconstruction.nam&&navMap.filters.taxon.name==reconstructMap.currentReconstruction.taxon&&navMap.filters.personFilter.name==reconstructMap.currentReconstruction.person)return;reconstructMap.currentReconstruction.nam.length<1?(reconstructMap.reset(),alert("Please click a time interval below to build a reconstruction map")):(reconstructMap.reset(),alert("Please click a time interval below to build a reconstruction map"))}},closeReconstructMap:function(){navMap.refresh("reset"),document.getElementById("reconstructBox").checked=!1,document.getElementById("viewByTimeBox").checked=!1,d3.select("#reconstructMap").style("display","none"),timeScale.unhighlight(),$(".zoom-in").hammer().on("tap",function(a){a.preventDefault(),parseInt(d3.select("#map").style("height"))<1?(console.log("here"),d3.select("#svgMap").style("display","none"),d3.select("#map").style("height",function(){return.7*window.innerHeight-70+"px"}),map.setView([7,0],3,{animate:!1}),navMap.refresh("reset"),map.invalidateSize()):map.zoomIn()}).css("color","#000"),$(".zoom-out").hammer().on("tap",function(a){a.preventDefault(),map.zoomOut()}).css("color","#000"),$(".save").off("click"),$(".icon-save").css("color","#000"),d3.select("#selectedInterval").select("button").style("display","block"),d3.select(".info").html("").style("display","none"),d3.select(".rotate").style("box-shadow","").style("color","#000"),d3.select(".time").style("color","#000"),parseInt(d3.select("#map").style("height"))<1?d3.select("#svgMap").style("display","block"):d3.select("#map").style("display","block"),navMap.resize(),map.invalidateSize()},baseUrl:a}}();$(document).ready(function(){paleo_nav.init()});